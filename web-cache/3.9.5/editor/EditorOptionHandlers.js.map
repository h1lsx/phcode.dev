{"version":3,"sources":["editor/EditorOptionHandlers.js"],"names":["define","require","exports","module","AppInit","Editor","Commands","CommandManager","PreferencesManager","Strings","EditorManager","ThemeManager","_","SHOW_LINE_NUMBERS","STYLE_ACTIVE_LINE","WORD_WRAP","CLOSE_BRACKETS","AUTO_HIDE_SEARCH","currentMaxLineLength","PREFERENCES_EDITOR_RULERS","PREFERENCES_EDITOR_RULER_COLORS","PREFERENCES_EDITOR_RULERS_ENABLED","_currentTheme","definePreference","description","DESCRIPTION_RULERS_ENABLED","DESCRIPTION_RULERS_COLUMNS","DESCRIPTION_RULERS_COLORS","_optionMapping","_updateCheckedState","name","mapping","get","setChecked","_getToggler","prefName","set","_createRulers","editor","rulerColumns","rulerColors","rulersEnabled","length","getCurrentTheme","defaultColor","dark","_codeMirror","getOption","rulerOptions","i","push","color","column","lineStyle","setOption","_resetRulers","forEveryEditor","_handleThemeChange","_init","each","commandName","getShowLineNumbers","_toggleLinePadding","on","_event","newActiveEditor","Math","max","EVENT_THEME_CHANGE","getMaxLineLength","TOGGLE_LINE_NUMBERS","TOGGLE_ACTIVE_LINE","TOGGLE_WORD_WRAP","TOGGLE_CLOSE_BRACKETS","TOGGLE_SEARCH_AUTOHIDE","TOGGLE_RULERS","Object","keys","forEach","preference","register","CMD_TOGGLE_LINE_NUMBERS","CMD_TOGGLE_ACTIVE_LINE","CMD_TOGGLE_WORD_WRAP","CMD_TOGGLE_CLOSE_BRACKETS","CMD_TOGGLE_SEARCH_AUTOHIDE","CMD_TOGGLE_RULERS","appReady"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2013 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\ndefine(function (require, exports, module) {\n\n\n    const AppInit             = require(\"utils/AppInit\"),\n        Editor              = require(\"editor/Editor\").Editor,\n        Commands            = require(\"command/Commands\"),\n        CommandManager      = require(\"command/CommandManager\"),\n        PreferencesManager  = require(\"preferences/PreferencesManager\"),\n        Strings             = require(\"strings\"),\n        EditorManager       = require(\"editor/EditorManager\"),\n        ThemeManager        = require(\"view/ThemeManager\"),\n        _                   = require(\"thirdparty/lodash\");\n\n    // Constants for the preferences referred to in this file\n    const SHOW_LINE_NUMBERS = \"showLineNumbers\",\n        STYLE_ACTIVE_LINE = \"styleActiveLine\",\n        WORD_WRAP         = \"wordWrap\",\n        CLOSE_BRACKETS    = \"closeBrackets\",\n        AUTO_HIDE_SEARCH  = \"autoHideSearch\";\n\n    let currentMaxLineLength = 120;\n\n    const PREFERENCES_EDITOR_RULERS = \"editor.rulers\",\n        PREFERENCES_EDITOR_RULER_COLORS = \"editor.rulerColors\",\n        PREFERENCES_EDITOR_RULERS_ENABLED = \"editor.rulersEnabled\";\n    PreferencesManager.definePreference(PREFERENCES_EDITOR_RULERS_ENABLED, \"boolean\", true, {\n        description: Strings.DESCRIPTION_RULERS_ENABLED\n    });\n    PreferencesManager.definePreference(PREFERENCES_EDITOR_RULERS, \"array\", [120], {\n        description: Strings.DESCRIPTION_RULERS_COLUMNS\n    });\n    PreferencesManager.definePreference(PREFERENCES_EDITOR_RULER_COLORS, \"array\", [], {\n        description: Strings.DESCRIPTION_RULERS_COLORS\n    });\n\n    let _currentTheme;\n    /**\n     * @private\n     *\n     * Maps from preference names to the command names needed to update the checked status.\n     */\n    let _optionMapping = {};\n    _optionMapping[SHOW_LINE_NUMBERS] = Commands.TOGGLE_LINE_NUMBERS;\n    _optionMapping[STYLE_ACTIVE_LINE] = Commands.TOGGLE_ACTIVE_LINE;\n    _optionMapping[WORD_WRAP] = Commands.TOGGLE_WORD_WRAP;\n    _optionMapping[CLOSE_BRACKETS] = Commands.TOGGLE_CLOSE_BRACKETS;\n    _optionMapping[AUTO_HIDE_SEARCH] = Commands.TOGGLE_SEARCH_AUTOHIDE;\n    _optionMapping[PREFERENCES_EDITOR_RULERS_ENABLED] = Commands.TOGGLE_RULERS;\n\n\n\n    /**\n     * @private\n     *\n     * Updates the command checked status based on the preference name given.\n     *\n     * @param {string} name Name of preference that has changed\n     */\n    function _updateCheckedState(name) {\n        var mapping = _optionMapping[name];\n        if (!mapping) {\n            return;\n        }\n        CommandManager.get(mapping).setChecked(PreferencesManager.get(name));\n    }\n\n    // Listen to preference changes for the preferences we care about\n    Object.keys(_optionMapping).forEach(function (preference) {\n        PreferencesManager.on(\"change\", preference, function () {\n            _updateCheckedState(preference);\n        });\n    });\n\n    /**\n     * @private\n     * Creates a function that will toggle the named preference.\n     *\n     * @param {string} prefName Name of preference that should be toggled by the function\n     */\n    function _getToggler(prefName) {\n        return function () {\n            PreferencesManager.set(prefName, !PreferencesManager.get(prefName));\n        };\n    }\n\n    function _createRulers(editor) {\n        const rulerColumns = PreferencesManager.get(PREFERENCES_EDITOR_RULERS) || [];\n        const rulerColors = PreferencesManager.get(PREFERENCES_EDITOR_RULER_COLORS) || [];\n        const rulersEnabled = PreferencesManager.get(PREFERENCES_EDITOR_RULERS_ENABLED);\n        if( !rulersEnabled || !rulerColumns.length || !editor){\n            return;\n        }\n\n        if(!_currentTheme){\n            _currentTheme = ThemeManager.getCurrentTheme();\n        }\n        if(!_currentTheme){\n            // theme manager can return a null current theme at startup before themes load!\n            return;\n        }\n        const defaultColor = (_currentTheme && _currentTheme.dark) ? \"#333333\" : \"#e0e0e0\";\n\n        if(!editor._codeMirror.getOption(\"rulers\")){\n            let rulerOptions = [];\n            for(let i=0; i<rulerColumns.length; i++) {\n                rulerOptions.push({\n                    color: rulerColors[i] ? rulerColors[i]: defaultColor,\n                    column: rulerColumns[i],\n                    lineStyle: \"solid !important\"\n                });\n            }\n            editor._codeMirror.setOption(\"rulers\", rulerOptions);\n        }\n    }\n\n    function _resetRulers() {\n        Editor.forEveryEditor(function (editor) {\n            editor._codeMirror.setOption(\"rulers\", null);\n            _createRulers(editor);\n        });\n    }\n\n    function _handleThemeChange() {\n        _currentTheme = ThemeManager.getCurrentTheme();\n        _resetRulers();\n    }\n\n    CommandManager.register(Strings.CMD_TOGGLE_LINE_NUMBERS, Commands.TOGGLE_LINE_NUMBERS, _getToggler(SHOW_LINE_NUMBERS));\n    CommandManager.register(Strings.CMD_TOGGLE_ACTIVE_LINE, Commands.TOGGLE_ACTIVE_LINE, _getToggler(STYLE_ACTIVE_LINE));\n    CommandManager.register(Strings.CMD_TOGGLE_WORD_WRAP, Commands.TOGGLE_WORD_WRAP, _getToggler(WORD_WRAP));\n    CommandManager.register(Strings.CMD_TOGGLE_CLOSE_BRACKETS, Commands.TOGGLE_CLOSE_BRACKETS, _getToggler(CLOSE_BRACKETS));\n    CommandManager.register(Strings.CMD_TOGGLE_SEARCH_AUTOHIDE, Commands.TOGGLE_SEARCH_AUTOHIDE, _getToggler(AUTO_HIDE_SEARCH));\n    CommandManager.register(Strings.CMD_TOGGLE_RULERS, Commands.TOGGLE_RULERS, _getToggler(PREFERENCES_EDITOR_RULERS_ENABLED));\n\n    function _init() {\n        _.each(_optionMapping, function (commandName, prefName) {\n            CommandManager.get(commandName).setChecked(PreferencesManager.get(prefName));\n        });\n\n        if (!Editor.getShowLineNumbers()) {\n            Editor._toggleLinePadding(true);\n        }\n\n        // fires for inline editor creation;\n        EditorManager.on('activeEditorChange', (_event, newActiveEditor)=>{\n            _createRulers(newActiveEditor);\n        });\n        PreferencesManager.on(\"change\", PREFERENCES_EDITOR_RULERS_ENABLED, _resetRulers);\n        PreferencesManager.on(\"change\", PREFERENCES_EDITOR_RULERS, ()=>{\n            const rulerColumns = PreferencesManager.get(PREFERENCES_EDITOR_RULERS) || [];\n            currentMaxLineLength = rulerColumns.length ? Math.max(...rulerColumns) : 120;\n            _resetRulers();\n        });\n        PreferencesManager.on(\"change\", PREFERENCES_EDITOR_RULER_COLORS, _resetRulers);\n        ThemeManager.on(ThemeManager.EVENT_THEME_CHANGE, _handleThemeChange);\n        _resetRulers();\n    }\n\n    function getMaxLineLength() {\n        return currentMaxLineLength;\n    }\n\n    AppInit.appReady(_init);\n\n    exports.getMaxLineLength = getMaxLineLength;\n});\n"],"file":"EditorOptionHandlers.js"}