define(function(require,exports,module){var AppInit=brackets.getModule("utils/AppInit"),CodeHintManager=brackets.getModule("editor/CodeHintManager"),CSSUtils=brackets.getModule("language/CSSUtils"),PreferencesManager=brackets.getModule("preferences/PreferencesManager"),TokenUtils=brackets.getModule("utils/TokenUtils"),StringMatch=brackets.getModule("utils/StringMatch"),ColorUtils=brackets.getModule("utils/ColorUtils"),Strings=brackets.getModule("strings"),CSSProperties=require("text!CSSProperties.json"),properties=JSON.parse(CSSProperties);require("./css-lint");const cssWideKeywords=["initial","inherit","unset","var()","calc()"];PreferencesManager.definePreference("codehint.CssPropHints","boolean",!0,{description:Strings.DESCRIPTION_CSS_PROP_HINTS});var lastContext,stringMatcherOptions={preferPrefixMatches:!0};function CssPropHints(){this.primaryTriggerKeys="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-()",this.secondaryTriggerKeys=":",this.exclusion=null}function vendorPrefixesAndGenericToEnd(hints){const nonDashHints=[],dashHints=[];return hints.forEach(hint=>{hint.label.startsWith("-")||cssWideKeywords.includes(hint.label)?dashHints.push(hint):nonDashHints.push(hint)}),nonDashHints.concat(dashHints)}function formatHints(hints){var hasColorSwatch=hints.some(function(token){return token.color});return StringMatch.basicMatchSort(hints),(hints=vendorPrefixesAndGenericToEnd(hints)).map(function(token){var $hintObj=$(`<span data-val='${token.label||token.value}'></span>`).addClass("brackets-css-hints brackets-hints");if(token.stringRanges?token.stringRanges.forEach(function(item){item.matched?$hintObj.append($("<span>").text(item.text).addClass("matched-hint")):$hintObj.append(item.text)}):$hintObj.text(token.value),hasColorSwatch&&($hintObj=ColorUtils.formatColorHint($hintObj,token.color)),token.MDN_URL){const $mdn=$(`<a class="css-code-hint-info" style="text-decoration: none;"\n                href="${token.MDN_URL}" title="${Strings.DOCS_MORE_LINK_MDN_TITLE}">\n                <i class="fa-solid fa-circle-info"></i></a>`);$hintObj=$(`<span data-val='${token.label||token.value}'></span>`).append($hintObj).append($mdn)}return $hintObj.attr("data-val",token.value),$hintObj})}function uniqueMerge(arr1,arr2){return arr2.forEach(item=>{arr1.includes(item)||arr1.push(item)}),arr1}CssPropHints.prototype.updateExclusion=function(propNameOnly){var textAfterCursor;this.exclusion&&this.info&&(this.info.context===CSSUtils.PROP_NAME?textAfterCursor=this.info.name.substr(this.info.offset):propNameOnly||this.info.context!==CSSUtils.PROP_VALUE||(textAfterCursor=this.info.value.substr(this.info.offset)),CodeHintManager.hasValidExclusion(this.exclusion,textAfterCursor)||(this.exclusion=null))},CssPropHints.prototype.hasHints=function(editor,implicitChar){this.editor=editor;var cursor=this.editor.getCursorPos();return lastContext=null,this.info=CSSUtils.getInfoAtPos(editor,cursor),(this.info.context===CSSUtils.PROP_NAME||this.info.context===CSSUtils.PROP_VALUE)&&(implicitChar?(this.updateExclusion(!1),this.info.context===CSSUtils.PROP_NAME&&(this.exclusion||1!==this.info.offset||implicitChar!==this.info.name[0]||(this.exclusion=this.info.name.substr(this.info.offset))),-1!==this.primaryTriggerKeys.indexOf(implicitChar)||-1!==this.secondaryTriggerKeys.indexOf(implicitChar)):(this.info.context===CSSUtils.PROP_NAME&&(0===this.info.offset?this.exclusion=this.info.name:this.updateExclusion(!0)),!0))},CssPropHints.prototype.getHints=function(implicitChar){this.cursor=this.editor.getCursorPos(),this.info=CSSUtils.getInfoAtPos(this.editor,this.cursor);let needle=this.info.name,valueNeedle="",context=this.info.context,valueArray,type,result,selectInitial=!1;return this.updateExclusion(!0),context===CSSUtils.PROP_VALUE?(selectInitial=!0,"("===implicitChar||(lastContext===CSSUtils.PROP_NAME||(lastContext=CSSUtils.PROP_VALUE,properties[needle]?(this.info.isNewItem||-1===this.info.index||(valueNeedle=(valueNeedle=this.info.values[this.info.index].trim()).substr(0,this.info.offset)),properties[needle].injectedCSSDefaults||(uniqueMerge(properties[needle].values,cssWideKeywords),properties[needle].injectedCSSDefaults=!0),valueArray=properties[needle].values,"color"===(type=properties[needle].type)&&(valueArray=valueArray.concat(ColorUtils.COLOR_NAMES.map(function(color){return{text:color,color:color}}))).push("transparent","currentColor"),{hints:formatHints(result=$.map(valueArray,function(pvalue){var result=StringMatch.stringMatch(pvalue.text||pvalue,valueNeedle,stringMatcherOptions);if(result)return pvalue.color&&(result.color=pvalue.color),result})),match:null,selectInitial:selectInitial}):null))):context===CSSUtils.PROP_NAME?(-1===this.primaryTriggerKeys.indexOf(implicitChar)&&""===needle||(selectInitial=!0),lastContext===CSSUtils.PROP_VALUE?null:(lastContext=CSSUtils.PROP_NAME,needle=needle.substr(0,this.info.offset),{hints:formatHints(result=$.map(properties,function(pvalues,pname){var result=StringMatch.stringMatch(pname,needle,stringMatcherOptions);if(result)return properties[pname].MDN_URL&&(result.MDN_URL=properties[pname].MDN_URL),result})),match:null,selectInitial:selectInitial,handleWideResults:!1})):null},CssPropHints.prototype.insertHint=function(hint){var offset=this.info.offset,cursor=this.editor.getCursorPos(),start={line:-1,ch:-1},end={line:-1,ch:-1},keepHints=!1,adjustCursor=!1,newCursor,ctx;if(hint.jquery&&(hint=hint.data("val")),this.info.context!==CSSUtils.PROP_NAME&&this.info.context!==CSSUtils.PROP_VALUE)return!1;if(start.line=end.line=cursor.line,start.ch=cursor.ch-offset,this.info.context===CSSUtils.PROP_NAME){keepHints=!0;var textAfterCursor=this.info.name.substr(this.info.offset);0===this.info.name.length||CodeHintManager.hasValidExclusion(this.exclusion,textAfterCursor)?(hint+=": ",end.ch=start.ch,end.ch+=offset,this.exclusion&&(hint+=" ",adjustCursor=!0,newCursor={line:cursor.line,ch:start.ch+hint.length-1},this.exclusion=null)):(end.ch=start.ch+this.info.name.length,(ctx=TokenUtils.getInitialContext(this.editor._codeMirror,cursor)).token.string.length>0&&!/\S/.test(ctx.token.string)&&TokenUtils.moveNextToken(ctx),TokenUtils.moveSkippingWhitespace(TokenUtils.moveNextToken,ctx)&&":"===ctx.token.string?(adjustCursor=!0,newCursor={line:cursor.line,ch:cursor.ch+(hint.length-this.info.name.length)},TokenUtils.moveNextToken(ctx)&&ctx.token.string.length>0&&!/\S/.test(ctx.token.string)&&(newCursor.ch+=ctx.token.string.length)):hint+=": ")}else{this.info.isNewItem||-1===this.info.index?end.ch=start.ch:end.ch=start.ch+this.info.values[this.info.index].length;var parenMatch=hint.match(/\(.*?\)/);parenMatch&&(adjustCursor=!0,newCursor={line:cursor.line,ch:start.ch+parenMatch.index+1},keepHints=!0)}return this.editor._codeMirror.replaceRange(hint,start,end),adjustCursor&&this.editor.setCursorPos(newCursor),keepHints},AppInit.appReady(function(){var cssPropHints=new CssPropHints;CodeHintManager.registerHintProvider(cssPropHints,["css","scss","less"],1),exports.cssPropHintProvider=cssPropHints})});
//# sourceMappingURL=main.js.map
