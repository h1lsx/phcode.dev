{"version":3,"sources":["phoenix/shell.js"],"names":["initVFS","ERR_CODES","LRUCache","MAX_ALLOWED_TAURI_WINDOWS","CLI_ARGS_QUERY_PARAM","CLI_CWD_QUERY_PARAM","cliArgs","cliCWD","singleInstanceCLIHandler","quitTimeAppUpdateHandler","PHOENIX_WINDOW_PREFIX","PHOENIX_EXTENSION_WINDOW_PREFIX","async","_getTauriWindowLabel","prefix","tauriWindowLabels","window","__TAURI__","invoke","windowLabels","label","startsWith","i","windowLabel","Error","openURLInPhoenixWindow","url","windowTitle","fullscreen","resizable","height","minHeight","width","minWidth","acceptFirstMouse","preferTabs","_prefixPvt","defaultHeight","defaultWidth","tauriWindow","WebviewWindow","title","undefined","fileDropEnabled","isTauriWindow","features","nativeWindow","open","Phoenix","libs","iconv","fs","utils","picomatch","globalAPI","app","getNodeState","cbfn","getProcessID","isNativeApp","registerQuitTimeAppUpdateHandler","handler","toggleDevtools","closeWindow","forceClose","instanceCount","extensionWindowCount","getPhoenixInstanceCount","allTauriWindowsLabels","tauriWindowLabel","e","console","error","getCurrent","close","process","exit","focusWindow","Promise","reject","setAlwaysOnTop","setFocus","clipboardReadText","clipboard","readText","navigator","getCommandLineArgs","phoenixURL","URL","location","href","cliQueryParam","searchParams","get","JSON","parse","decodeURIComponent","cliCWDQueryParam","cwd","args","setSingleInstanceCLIArgsHandler","handlerFn","event","listen","payload","receivedEvent","log","fileURL","fileURLArray","tauri","eventToUse","push","replace","fileUrlEntry","then","filesURLList","length","isPrimaryDesktopPhoenixWindow","isPrimary","emit","clipboardReadFiles","resolve","files","vfsPaths","platformPath","VFS","getTauriVirtualPath","catch","copyToClipboard","textToCopy","writeText","textArea","document","createElement","value","body","appendChild","select","execCommand","removeChild","isFullscreen","appWindow","fullscreenElement","setFullscreen","enable","documentElement","requestFullscreen","exitFullscreen","getDisplayLocation","fullVFSPath","getTauriDir","getTauriPlatformPath","getMountDir","Strings","STORED_IN_YOUR_BROWSER","getDisplayPath","fullOrRelativeVFSPath","canMoveToTrash","moveToTrash","deletePath","setWindowTitle","setTitle","getWindowTitle","openPathInFileBrowser","toLowerCase","path","openURLInDefaultBrowser","tabIdentifier","shell","currentWindowLabel","includes","windowCount","getPlatformArch","os","arch","openNewPhoenixEditorWindow","preferredWidth","preferredHeight","_cliArgsArray","_cwd","cliVal","encodeURIComponent","stringify","set","delete","zoomWebView","scaleFactor","getApplicationSupportDirectory","getAppSupportDir","getExtensionsDirectory","getExtensionDir","getUserDocumentsDirectory","getUserProjectsDirectory","getTempDirectory","getTempDir","getTimeSinceStartup","Date","now","startTime","language","appshell"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it under\n * the terms of the GNU Affero General Public License as published by the Free\n * Software Foundation, either version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License along\n * with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n// jshint ignore: start\n/*eslint no-console: 0*/\n/*eslint strict: [\"error\", \"global\"]*/\n/*global Phoenix, fs*/\n\n\n/** Setup phoenix shell components\n *\n * This module should be functionally as light weight as possible with minimal deps as it is a shell component.\n * **/\nimport initVFS from \"./init_vfs.js\";\nimport ERR_CODES from \"./errno.js\";\nimport { LRUCache } from '../thirdparty/no-minify/lru-cache.js';\n\ninitVFS();\n\n// We can only have a maximum of 30 windows that have access to tauri apis\n// This limit is set in file `tauri.conf.json` in phoenix-desktop repo at json paths\n// this limit is there due to our use of phtauri:// custom protocol.\n// /tauri/security/dangerousRemoteDomainIpcAccess/0/windows and\n// /tauri/security/dangerousRemoteDomainIpcAccess/1/windows\nconst MAX_ALLOWED_TAURI_WINDOWS = 30;\nconst CLI_ARGS_QUERY_PARAM = 'CLI_ARGS';\nconst CLI_CWD_QUERY_PARAM = 'CLI_CWD';\nlet cliArgs, cliCWD, singleInstanceCLIHandler, quitTimeAppUpdateHandler;\nconst PHOENIX_WINDOW_PREFIX = 'phcode-';\nconst PHOENIX_EXTENSION_WINDOW_PREFIX = 'extn-';\n\nasync function _getTauriWindowLabel(prefix) {\n    // cannot use tauri sync api here as it returns stale window list window.__TAURI__.window.getAll();\n    const tauriWindowLabels = await window.__TAURI__.invoke('_get_window_labels');\n    const windowLabels = {};\n    for(let label of tauriWindowLabels) {\n        if(label.startsWith(prefix)){\n            windowLabels[label]=true;\n        }\n    }\n    for(let i=1; i<=MAX_ALLOWED_TAURI_WINDOWS; i++){\n        const windowLabel = `${prefix}${i}`;\n        if(!windowLabels[windowLabel]){\n            return windowLabel;\n        }\n    }\n    throw new Error(\"Could not get a free window label to create tauri window\");\n}\n\nasync function openURLInPhoenixWindow(url, {\n    windowTitle, fullscreen, resizable,\n    height, minHeight, width, minWidth, acceptFirstMouse, preferTabs, _prefixPvt = PHOENIX_EXTENSION_WINDOW_PREFIX\n} = {}){\n    const defaultHeight = 900, defaultWidth = 1366;\n    if(window.__TAURI__){\n        const windowLabel = await _getTauriWindowLabel(_prefixPvt);\n        const tauriWindow = new window.__TAURI__.window.WebviewWindow(windowLabel, {\n            url,\n            title: windowTitle || windowLabel || url,\n            fullscreen,\n            resizable: resizable === undefined ? true : resizable,\n            height: height || defaultHeight,\n            minHeight: minHeight || 600,\n            width: width || defaultWidth,\n            minWidth: minWidth || 800,\n            acceptFirstMouse: acceptFirstMouse === undefined ? true : acceptFirstMouse,\n            fileDropEnabled: false\n        });\n        tauriWindow.isTauriWindow = true;\n        return tauriWindow;\n    }\n    let features = 'toolbar=no,location=no, status=no, menubar=no, scrollbars=yes';\n    features = `${features}, width=${width||defaultWidth}, height=${height||defaultHeight}`;\n    if(resizable === undefined || resizable){\n        features = features + \", resizable=yes\";\n    }\n    if(preferTabs) {\n        features = \"\";\n    }\n    const nativeWindow = window.open(url, '_blank', features);\n    nativeWindow.isTauriWindow = false;\n    return nativeWindow;\n}\n\nPhoenix.libs = {\n    LRUCache,\n    iconv: fs.utils.iconv,\n    picomatch: fs.utils.picomatch\n};\n\n// global API is only usable/stable after App init\nPhoenix.globalAPI = {};\n\nPhoenix.app = {\n    getNodeState: function (cbfn){\n        cbfn(new Error('Node cannot be run in phoenix browser mode'));\n    },\n    getProcessID: function () {\n        if(!Phoenix.isNativeApp){\n            throw new Error(\"getProcessID is not supported in browsers\");\n        }\n        return window.__TAURI__.invoke(\"get_process_id\");\n    },\n    registerQuitTimeAppUpdateHandler: function (handler) {\n        if(!Phoenix.isNativeApp){\n            throw new Error(\"registerQuitTimeAppUpdateHandler is not supported in browsers\");\n        }\n        quitTimeAppUpdateHandler = handler;\n    },\n    toggleDevtools: async function () {\n        if(!Phoenix.isNativeApp){\n            throw new Error(\"toggle_devtools is not supported in browsers\");\n        }\n        return window.__TAURI__.invoke(\"toggle_devtools\", {});\n    },\n    closeWindow: async function (forceClose) {\n        if(!Phoenix.isNativeApp){\n            throw new Error(\"closeWindow is not supported in browsers\");\n        }\n        let instanceCount = 0;\n        let extensionWindowCount = 0;\n        try{\n            instanceCount = await Phoenix.app.getPhoenixInstanceCount();\n            const allTauriWindowsLabels  = await window.__TAURI__.invoke('_get_window_labels');\n            for(let tauriWindowLabel of allTauriWindowsLabels){\n                if(tauriWindowLabel && tauriWindowLabel.startsWith(PHOENIX_EXTENSION_WINDOW_PREFIX)) {\n                    extensionWindowCount ++;\n                }\n            }\n        } catch (e) {\n            console.error(\"Ignoring Error while Phoenix.app.closeWindow: \", e);\n        }\n        if(instanceCount === 1 && !extensionWindowCount) {\n            // we are the only window, so use process quit as in some os, hidden tauri windows will prevent app quit.\n            if(!forceClose && quitTimeAppUpdateHandler){\n                try{\n                    await quitTimeAppUpdateHandler();\n                }catch (e) {\n                    // we never fail the quit loop, ele the window ill never go away.\n                    console.error(e);\n                }\n            }\n            window.__TAURI__.process.exit(0);\n            return;\n        }\n        window.__TAURI__.window.getCurrent().close();\n    },\n    focusWindow: function () {\n        if(!Phoenix.isNativeApp){\n            return Promise.reject(new Error(\"focusWindow is not supported in browsers\"));\n        }\n        window.__TAURI__.window.getCurrent().setAlwaysOnTop(true);\n        window.__TAURI__.window.getCurrent().setFocus();\n        window.__TAURI__.window.getCurrent().setAlwaysOnTop(false);\n    },\n    clipboardReadText: function () {\n        if(Phoenix.isNativeApp){\n            return window.__TAURI__.clipboard.readText();\n        } else if(window.navigator && window.navigator.clipboard){\n            return window.navigator.clipboard.readText();\n        }\n        return Promise.reject(new Error(\"clipboardReadText: Not supported.\"));\n    },\n    /**\n     * Gets the commandline argument in desktop builds and null in browser builds.\n     * Will always return CLI of the current process only.\n     * @return {Promise<{cwd:string,args:string[]}|null>}\n     */\n    getCommandLineArgs: async function () {\n        if(!Phoenix.isNativeApp){\n            return null;\n        }\n        const phoenixURL = new URL(location.href);\n        const cliQueryParam = phoenixURL.searchParams.get(CLI_ARGS_QUERY_PARAM);\n        // the cli passed in through the url takes highest precedence as we have a single tauri instance,\n        // new windows will be spawned with the cli query param url. Eg. (File>new window, or double clicking\n        // phoenix icon or launching phoenix with cli args) while another phoenix window is open.\n        // So only the first window to open will have the original cli query param, every other window will have\n        // it override with query params.\n        if(cliQueryParam){\n            cliArgs = JSON.parse(decodeURIComponent(cliQueryParam));\n        }\n        const cliCWDQueryParam = phoenixURL.searchParams.get(CLI_CWD_QUERY_PARAM);\n        if(cliCWDQueryParam){\n            cliCWD = JSON.parse(decodeURIComponent(cliCWDQueryParam));\n        }\n        if(cliArgs){\n            return {\n                cwd: cliCWD,\n                args: cliArgs\n            };\n        }\n        cliArgs = null;\n        cliCWD = await window.__TAURI__.invoke(\"get_current_working_dir\");\n        cliArgs = await window.__TAURI__.invoke('_get_commandline_args');\n        return {\n            cwd: cliCWD,\n            args: cliArgs\n        };\n    },\n    /**\n     * Only a single instance of the app will be present at any time. When another instacne is opened from either cli or\n     * double clicking a file in file explorer in os, the handler will be called with the command line args with the\n     * file that was double-clicked (or folder using open with) in os file explorer/cli.\n     * @param {function([string]cliArgs, cwd)} handlerFn - the handler function will receive two args on callback, the cliArgs\n     *  of the other phoenix process that was invoked to open the file and its current working dir. cwd may be null\n     * @return {*}\n     */\n    setSingleInstanceCLIArgsHandler: function (handlerFn) {\n        if(singleInstanceCLIHandler){\n            throw new Error(\"A single instance handler is already registered!\");\n        }\n        if(handlerFn){\n            singleInstanceCLIHandler = handlerFn;\n        }\n        if(Phoenix.isNativeApp){\n            window.__TAURI__.event.listen(\"single-instance\", ({payload})=> {\n                handlerFn(payload.args, payload.cwd);\n            });\n            window.__TAURI__.event.listen(\"scheme-request-received\", (receivedEvent)=> {\n                // this is for mac-os open with processing from finder.\n                console.log(\"Macos received Event from OS:\", receivedEvent);\n                const fileURL = receivedEvent.payload;\n                const fileURLArray = receivedEvent.payload.fileURLArray;\n                window.__TAURI__.tauri.invoke(\"get_mac_deep_link_requests\");// this will clear the cached queue in shell\n                const eventToUse = [\"macOSEvent\"];\n                if(typeof fileURL === 'string'){\n                    eventToUse.push(decodeURIComponent(fileURL.replace(\"file://\", \"\")));\n                } else if(fileURLArray){\n                    for(let fileUrlEntry of fileURLArray){\n                        eventToUse.push(decodeURIComponent(fileUrlEntry.replace(\"file://\", \"\")));\n                    }\n                }\n                handlerFn(eventToUse, \"\");\n            });\n            window.__TAURI__.tauri.invoke(\"get_mac_deep_link_requests\").then(filesURLList=>{\n                if(!filesURLList.length){\n                    return;\n                }\n                // this is special handling for open with to work from mac finder. Mac will raise and event which will\n                // be buffered in the shell till the app reads the opened file list. Once read, the file list will be\n                // emptied in shell and no other instances will get the data, so we have to process it here.\n                Phoenix.app.isPrimaryDesktopPhoenixWindow().then(isPrimary=>{\n                    if(isPrimary){\n                        const eventToUse = [\"macOSEvent\"];\n                        for(let fileUrlEntry of filesURLList){\n                            eventToUse.push(decodeURIComponent(fileUrlEntry.replace(\"file://\", \"\")));\n                        }\n                        handlerFn(eventToUse, \"\");\n                        return;\n                    }\n                    window.__TAURI__.event.emit('scheme-request-received', {fileURLArray: filesURLList});\n                });\n            });\n        }\n    },\n    clipboardReadFiles: function () {\n        return new Promise((resolve, reject)=>{\n            if(Phoenix.isNativeApp){\n                window.__TAURI__.tauri.invoke('_get_clipboard_files')\n                    .then(files =>{\n                        if(!files){\n                            resolve(files);\n                            return;\n                        }\n                        const vfsPaths = [];\n                        for(let platformPath of files) {\n                            vfsPaths.push(Phoenix.VFS.getTauriVirtualPath(platformPath));\n                        }\n                        resolve(vfsPaths);\n                    }).catch(reject);\n            } else {\n                resolve();\n            }\n        });\n    },\n    copyToClipboard: function (textToCopy) {\n        if(Phoenix.isNativeApp){\n            return window.__TAURI__.clipboard.writeText(textToCopy);\n        } else if(window.navigator && window.navigator.clipboard){\n            return window.navigator.clipboard.writeText(textToCopy);\n        }\n        const textArea = document.createElement(\"textarea\");\n        textArea.value = textToCopy;\n        document.body.appendChild(textArea);\n        textArea.select();\n        document.execCommand(\"copy\");\n        document.body.removeChild(textArea);\n        return Promise.resolve();\n    },\n    isFullscreen: function () {\n        if(!Phoenix.isNativeApp) {\n            // use browser full screen api in browsers.\n            return Promise.resolve(!!document.fullscreenElement);\n        }\n        return window.__TAURI__.window.appWindow.isFullscreen();\n    },\n    setFullscreen: function (enable) {\n        if(!Phoenix.isNativeApp) {\n            // use browser full screen api in browsers.\n            if (enable) {\n                return document.documentElement.requestFullscreen();\n            } else if (document.exitFullscreen) {\n                return  document.exitFullscreen();\n            } else {\n                return Promise.resolve();\n            }\n        }\n        return window.__TAURI__.window.appWindow.setFullscreen(enable);\n    },\n    getDisplayLocation: function (fullVFSPath) {\n        // reruns a user-friendly location that can be shown to the user to make some sense of the virtual file path.\n        // The returned path may not be an actual path if it is not resolvable to a platform path, but a text indicating\n        // its location. Eg: \"Stored in Your Browser\"\n        if (fullVFSPath.startsWith(Phoenix.VFS.getTauriDir())) {\n            return Phoenix.fs.getTauriPlatformPath(fullVFSPath);\n        }\n        if (fullVFSPath.startsWith(Phoenix.VFS.getMountDir())) {\n            return fullVFSPath.replace(Phoenix.VFS.getMountDir(), \"\");\n        }\n        return window.Strings.STORED_IN_YOUR_BROWSER;\n    },\n    getDisplayPath: function (fullOrRelativeVFSPath) {\n        if(!fullOrRelativeVFSPath){\n            return \"\";\n        }\n        // reruns a path that can be shown to the user to make some sense of the virtual file path.\n        // The returned path is platform path for tauri,\n        // a relative path of the form (folder/file.txt) starting with opened folder name for fs access- /mnt/paths\n        // or virtual path if we cant figure out a tauri/fs access path\n        if (fullOrRelativeVFSPath.startsWith(Phoenix.VFS.getTauriDir())) {\n            return Phoenix.fs.getTauriPlatformPath(fullOrRelativeVFSPath);\n        }\n        if (fullOrRelativeVFSPath.startsWith(Phoenix.VFS.getMountDir())) {\n            return fullOrRelativeVFSPath.replace(Phoenix.VFS.getMountDir(), \"\");\n        }\n        return fullOrRelativeVFSPath;\n    },\n    canMoveToTrash: function(fullVFSPath) {\n        if(!Phoenix.isNativeApp || !fullVFSPath || !fullVFSPath.startsWith(Phoenix.VFS.getTauriDir())){\n            // only tauri paths can be moved to trash\n            return false;\n        }\n        return true;\n    },\n    moveToTrash: async function(fullVFSPath) {\n        if(!Phoenix.isNativeApp){\n            throw new Error(\"moveToTrash is not supported in browsers\");\n        }\n        if(!fullVFSPath){\n            throw new Error(\"Please specify a path to move to trash\");\n        }\n        if(!fullVFSPath.startsWith(Phoenix.VFS.getTauriDir())) {\n            throw new Error(\"moveToTrash only works with tauri paths, but got: \"+ fullVFSPath);\n        }\n        const platformPath = Phoenix.fs.getTauriPlatformPath(fullVFSPath);\n        return window.__TAURI__.invoke('move_to_trash', { deletePath: platformPath });\n    },\n    setWindowTitle: async function (title) {\n        window.document.title = title;\n        if(Phoenix.isNativeApp) {\n            await window.__TAURI__.window.appWindow.setTitle(title);\n        }\n    },\n    getWindowTitle: async function () {\n        if(Phoenix.isNativeApp) {\n            return window.__TAURI__.window.appWindow.title();\n        }\n        return window.document.title;\n    },\n    openPathInFileBrowser: function (fullVFSPath){\n        return new Promise((resolve, reject)=>{\n            if(!window.__TAURI__ ||\n                !fullVFSPath.startsWith(Phoenix.VFS.getTauriDir())) {\n                reject(\"openPathInFileBrowser is only currently supported in Native builds for tauri paths!\");\n                return;\n            }\n            if(fullVFSPath.toLowerCase().startsWith(\"http://\")\n                || fullVFSPath.toLowerCase().startsWith(\"https://\")\n                || fullVFSPath.toLowerCase().startsWith(\"file://\")) {\n                reject(\"Please use openPathInFileBrowser API to open URLs\");\n                return;\n            }\n            const platformPath = Phoenix.fs.getTauriPlatformPath(fullVFSPath);\n            window.__TAURI__.tauri\n                .invoke('show_in_folder', {path: platformPath})\n                .then(resolve)\n                .catch(reject);\n        });\n    },\n    openURLInDefaultBrowser: function (url, tabIdentifier='_blank'){\n        return new Promise((resolve, reject)=>{\n            if(!window.__TAURI__) {\n                resolve(window.open(url, tabIdentifier, 'noopener,noreferrer'));\n                return;\n            }\n            if( !(url.toLowerCase().startsWith(\"http://\") || url.toLowerCase().startsWith(\"https://\")) ) {\n                reject(\"openURLInDefaultBrowser: URL should be http or https, but was \" + url);\n                return;\n            }\n            window.__TAURI__.shell.open(url)\n                .then(resolve)\n                .catch(reject);\n        });\n    },\n    /**\n     * In a multi window setup in desktop, we operate in tauri single window mode. So there may be multiple windows\n     * for different phoenix editors, but only a single tauri process. One of them is a leader who gets to do special\n     * duties like opening a `new window` instance/ anything that needs a single responsibility. Note that the leader\n     * will cycle though as new windows comes and goes. Usually the leader is a phoenix window with the lowest\n     * tauri window label.\n     * @return {Promise<boolean>}\n     */\n    isPrimaryDesktopPhoenixWindow: async function () {\n        if(!Phoenix.isNativeApp) {\n            // there is no primary window concept in browsers. all are primary for now.\n            console.error(\"isPrimaryDesktopPhoenixWindow is not supported in browsers!\");\n            return true;\n        }\n        const currentWindowLabel = window.__TAURI__.window.getCurrent().label;\n        if(currentWindowLabel === 'main'){\n            // main window if there will be the primary\n            return true;\n        }\n        const allTauriWindowsLabels  = await window.__TAURI__.invoke('_get_window_labels');\n        if(allTauriWindowsLabels.includes('main')){\n            // we are not main and there is a main window in tauri windows\n            return false;\n        }\n        // the main window has been closed and some other window is the primary now.\n        // the one with the lowest label is primary\n        for(let tauriWindowLabel of allTauriWindowsLabels){\n            if(tauriWindowLabel && tauriWindowLabel.startsWith(PHOENIX_WINDOW_PREFIX) &&\n                currentWindowLabel !== tauriWindowLabel && currentWindowLabel > tauriWindowLabel) {\n                return false;\n            }\n        }\n        return true;\n    },\n    /**\n     * Gets the number of phoenix windows open.\n     * @return {Promise<number>}\n     */\n    getPhoenixInstanceCount: async function () {\n        if(!Phoenix.isNativeApp) {\n            // there is no primary window concept in browsers. all are primary for now.\n            console.error(\"getPhoenixInstanceCount is not supported in browsers!\");\n            return true;\n        }\n        let windowCount = 0;\n        const allTauriWindowsLabels  = await window.__TAURI__.invoke('_get_window_labels');\n        for(let tauriWindowLabel of allTauriWindowsLabels){\n            if(tauriWindowLabel && (tauriWindowLabel.startsWith(PHOENIX_WINDOW_PREFIX) || tauriWindowLabel === 'main')) {\n                windowCount ++;\n            }\n        }\n        return windowCount;\n    },\n    /**\n     * Returns the operating system CPU architecture for which the tauri app was compiled. Possible values are\n     * 'x86', 'x86_64', 'arm', 'aarch64', 'mips', 'mips64', 'powerpc', 'powerpc64', 'riscv64', 's390x', 'sparc64'.\n     * @return {Promise<string>}\n     */\n    getPlatformArch: async function () {\n        if(!Phoenix.isNativeApp) {\n            // there is no primary window concept in browsers. all are primary for now.\n            console.error(\"getPlatformArch is not supported in browsers!\");\n            return true;\n        }\n        return window.__TAURI__.os.arch();\n    },\n    openNewPhoenixEditorWindow: async function (preferredWidth, preferredHeight, _cliArgsArray, _cwd) {\n        const phoenixURL = new URL(location.href);\n        if(_cliArgsArray){\n            const cliVal = encodeURIComponent(JSON.stringify(_cliArgsArray));\n            phoenixURL.searchParams.set(CLI_ARGS_QUERY_PARAM, cliVal);\n        } else {\n            phoenixURL.searchParams.delete(CLI_ARGS_QUERY_PARAM);\n        }\n        if(_cwd){\n            const cliVal = encodeURIComponent(JSON.stringify(_cwd));\n            phoenixURL.searchParams.set(CLI_CWD_QUERY_PARAM, cliVal);\n        } else {\n            phoenixURL.searchParams.delete(CLI_CWD_QUERY_PARAM);\n        }\n        await openURLInPhoenixWindow(phoenixURL.href, {\n            width: preferredWidth,\n            height: preferredHeight,\n            preferTabs: true,\n            _prefixPvt: PHOENIX_WINDOW_PREFIX\n        });\n    },\n    openURLInPhoenixWindow: openURLInPhoenixWindow,\n    zoomWebView: function (scaleFactor = 1) {\n        if(!Phoenix.isNativeApp){\n            throw new Error(\"zoomWebView is not supported in browsers\");\n        }\n        if(scaleFactor < .1 || scaleFactor > 2) {\n            throw new Error(\"zoomWebView scale factor should be between .1 and 2\");\n        }\n        return window.__TAURI__.tauri.invoke(\"zoom_window\", {scaleFactor: scaleFactor});\n    },\n    getApplicationSupportDirectory: Phoenix.VFS.getAppSupportDir,\n    getExtensionsDirectory: Phoenix.VFS.getExtensionDir,\n    getUserDocumentsDirectory: Phoenix.VFS.getUserDocumentsDirectory,\n    getUserProjectsDirectory: Phoenix.VFS.getUserProjectsDirectory,\n    getTempDirectory: Phoenix.VFS.getTempDir,\n    ERR_CODES: ERR_CODES,\n    getTimeSinceStartup: function () {\n        return Date.now() - Phoenix.startTime; // milliseconds elapsed since app start\n    },\n    language: navigator.language\n};\n\nif(!window.appshell){\n    window.appshell = Phoenix;\n}\n"],"file":"shell.js"}