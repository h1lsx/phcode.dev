{"version":3,"sources":["project/ProjectManager.js"],"names":["define","require","exports","module","_","AppInit","Async","PreferencesDialogs","PreferencesManager","DocumentManager","MainViewManager","CommandManager","Commands","Dialogs","DefaultDialogs","EventDispatcher","LanguageManager","Menus","StringUtils","Strings","FileSystem","FileViewController","PerfUtils","FileUtils","FileSystemError","Urls","FileSyncManager","ProjectModel","FileTreeView","WorkingSetView","ViewUtils","ZipUtils","Metrics","EVENT_PROJECT_BEFORE_CLOSE","EVENT_PROJECT_CLOSE","EVENT_PROJECT_OPEN_FAILED","EVENT_PROJECT_OPEN","EVENT_AFTER_PROJECT_OPEN","EVENT_AFTER_STARTUP_FILES_LOADED","EVENT_PROJECT_REFRESH","EVENT_CONTENT_CHANGED","EVENT_PROJECT_FILE_CHANGED","EVENT_PROJECT_FILE_RENAMED","EVENT_PROJECT_CHANGED_OR_RENAMED_PATH","setLeakThresholdForEvent","CLIPBOARD_SYNC_KEY","SETTINGS_FILENAME","SETTINGS_FILENAME_BRACKETS","SORT_DIRECTORIES_FIRST","_fileSystemChange","_fileSystemRename","_showErrorDialog","_saveTreeState","_renderTreeSync","_renderTree","ERR_TYPE_CREATE","ERR_TYPE_CREATE_EXISTS","ERR_TYPE_RENAME","ERR_TYPE_DELETE","ERR_TYPE_LOADING_PROJECT","ERR_TYPE_LOADING_PROJECT_NATIVE","ERR_TYPE_MAX_FILES","ERR_TYPE_OPEN_DIALOG","ERR_TYPE_INVALID_FILENAME","ERR_TYPE_MOVE","ERR_TYPE_PASTE","ERR_TYPE_PASTE_FAILED","ERR_TYPE_DUPLICATE_FAILED","ERR_TYPE_DOWNLOAD_FAILED","$projectTreeContainer","fileTreeViewContainer","_hasFileSelectionFocus","getFileSelectionFocus","PROJECT_MANAGER","model","focused","_projectWarnedForTooManyFiles","_displayCreationError","e","errorInfo","window","setTimeout","error","type","isFolder","name","ALREADY_EXISTS","ERROR_INVALID_FILENAME","_invalidChars","errString","NOT_WRITABLE","NO_MODIFICATION_ALLOWED_ERR","format","GENERIC_ERROR","getPromise","_revertSelection","previousPath","switchToWorkingSet","setSelected","setFileViewFocus","WORKING_SET_VIEW","ActionCreator","this","_bindEvents","prototype","on","EVENT_CHANGE","EVENT_SHOULD_SELECT","data","add","openFileAndAddToWorkingSet","path","fail","partial","hadFocus","openAndSelectDocument","EVENT_SHOULD_FOCUS","ERROR_CREATION","setDirectoryOpen","open","then","doNotOpen","selectInWorkingSet","openWithExternalApplication","setContext","restoreContext","startRename","isMoved","renameItemInline","setRenameValue","cancelRename","performRename","startCreating","basedir","newName","setSortDirectoriesFirst","sortDirectoriesFirst","setFocused","setCurrentFile","curFile","toggleSubdirectories","openOrClose","closeSubtree","dragItem","$","length","closeAll","last","moveItem","oldPath","newDirectory","fileName","newPath","getBaseName","self","getParentPath","_ensureTrailingSlash","refresh","actionCreator","getFileTreeContext","selectedEntry","getContext","getSelectedItem","getSelected","getCurrentlyViewedFile","_fileViewControllerChange","_documentSelectionFocusChange","curFullPath","getCurrentlyViewedPath","ACTIVE_PANE","_currentFileChange","getBaseUrl","setBaseUrl","projectBaseUrl","setViewState","STATE_PROJECT_CONTEXT","isWithinProject","absPathOrEntry","filterProjectFiles","absPathOrEntryArray","filteredPaths","forEach","file","push","makeProjectRelativeIfPossible","absPath","getProjectRelativeOrDisplayPath","fullPath","Phoenix","app","getDisplayPath","getProjectRoot","projectRoot","_setProjectRoot","rootEntry","d","Deferred","setProjectRoot","resolve","reopenNodes","getViewState","promise","_saveProjectPath","openNodes","getOpenNodes","errType","dstPath","titleType","DIRECTORY_TITLE","FILE_TITLE","entryType","DIRECTORY","FILE","title","message","breakableUrl","ERROR_CREATING_FILE_TITLE","ERROR_CREATING_FILE","INVALID_FILENAME_TITLE","ENTRY_WITH_SAME_NAME_EXISTS","ERROR_RENAMING_FILE_TITLE","ERROR_RENAMING_FILE","ERROR_MOVING_FILE_TITLE","ERROR_MOVING_FILE","ERROR_DELETING_FILE_TITLE","ERROR_DELETING_FILE","ERROR_LOADING_PROJECT","READ_DIRECTORY_ENTRIES_ERROR","REQUEST_NATIVE_FILE_SYSTEM_ERROR","ERROR_MAX_FILES_TITLE","ERROR_MAX_FILES","OPEN_DIALOG_ERROR","DIRECTORY_NAME","FILENAME","INVALID_FILENAME_MESSAGE","DIRECTORY_NAMES_LEDE","FILENAMES_LEDE","CANNOT_PASTE_TITLE","CANNOT_DUPLICATE_TITLE","CANNOT_DOWNLOAD_TITLE","showModalDialog","DIALOG_ID_ERROR","_RENDER_DEBOUNCE_TIME","getWelcomeProjectPath","VFS","getDefaultProjectDir","getPlaceholderProjectPath","getExploreProjectPath","getLocalProjectsPath","getUserProjectsDirectory","addWelcomeProjectPath","welcomeProjects","_addWelcomeProjectPath","isWelcomeProjectPath","_isWelcomeProjectPath","updateWelcomeProjectPath","getInitialProjectPath","async","_dirExists","entry","resolveAsync","isDirectory","_safeCheckFolder","absOrRelativePath","relativeToDir","folderToOpen","join","getTauriVirtualPath","dirExists","console","warn","_getStartupProjectFromCLIArgs","cliArgs","getCommandLineArgs","args","cwd","countEvent","EVENT_TYPE","PLATFORM","getStartupProjectPath","startupProjectPath","_isProjectSafeToStartup","_mergeProjectGitIgnores","rootPath","gitIgnoreFilters","mergedGitIgnoreFile","filter","gitIgnoreContent","projectRelativePath","basePath","lines","line","split","trim","startsWith","isNegated","pattern","substring","endsWith","match","_watchProjectRoot","gitIgnoreFilter","computeProjectGitIgnoreAsync","defaultIgnoreGlobs","watch","getDirectoryForPath","_shouldShowName","err","TOO_MANY_ENTRIES","_resetCache","_unwatchProjectRoot","result","off","unwatch","reject","forceRender","setScrollerInfo","scrollWidth","scrollTop","scrollLeft","offset","top","render","_viewModel","brackets","platform","debounce","PREF_OK","PREF_JSON_ERR","PREF_NO_FILE","_validateProjectPreferencesFile","filePath","Promise","getFileForPath","readAsText","done","text","JSON","parse","_reloadProjectPreferencesScope","root","phoenixPrefFile","bracketsPrefFile","statusPhoenix","statusBrackets","prefFileToUse","_alertBrokenPreferenceFile","_setProjectSettingsFile","alertIsShown","errorPrefFile","info","findInAllWorkingSets","paneId","ERROR_PREFS_CORRUPT_TITLE","ERROR_PROJ_PREFS_CORRUPT","focusActivePane","_loadExistingProject","projectRootChanged","perfTimerName","markStart","always","_setCurrentFile","trigger","projectLoadTime","addMeasurement","valueEvent","PERFORMANCE","Number","_SAMPLE_HTML","_createDefaultProject","projectDir","exists","ensureExistsDir","logger","reportError","indexFile","normalize","fs","writeFile","_loadWelcomeProject","welcomeProjectPath","_loadRootEntry","_loadPlaceholderProject","placeHolderErr","alert","placeholderProject","isNativeApp","firstBoot","catch","_loadProjectInternal","NOT_FOUND","_loadProject","PROJECT","_closeAll","ALL_PANES","_resetPathLanguageOverrides","_reloadUserPrefs","_refreshDelay","refreshFileTree","clearAllCaches","_showFolderFirst","newPref","get","set","showInTree","_filePickerSupported","showOpenFilePicker","openProject","execute","FILE_CLOSE_ALL","promptOnly","showOpenDialog","CHOOSE_FOLDER","files","UNSUPPORTED_BROWSER_OPEN_FOLDER_TITLE","UNSUPPORTED_BROWSER_OPEN_FOLDER","_projectSettings","showProjectPreferencesDialog","createNewItem","baseDir","initialName","skipRename","getDirectoryInProject","createAtPath","moveToTrash","canMoveToTrash","NOT_SUPPORTED","_getProjectDisplayNameOrPath","messageTemplate","DELETE_TO_RECYCLE_BIN","DELETE_TO_TRASH","setProjectBusy","parent","notifyPathDeleted","_updateModelWithChange","dirname","getFileErrorString","finally","deleteItem","DELETING","unlink","getLanguageFilter","languageId","languageFilter","id","getLanguageForPath","getId","indexOf","handleFSEvent","forceFinishRename","_setFileTreeSelectionWidth","width","setSelectionWidth","event","added","removed","syncOpenDocuments","removedInProject","addedInProject","parentPath","oldName","oldParent","newParent","notifyPathNameChanged","_numPendingOperations","projectBusyMessages","isBusy","$projectSpinner","PROJECT_BUSY","log","index","splice","attr","removeClass","addClass","queuePathForSelection","_duplicateFileCMD","context","DUPLICATING","getFreePath","dupePath","copy","copiedStats","ERR_TYPE_DUPLICATE_FAILED_NO_FILE","_zipFailed","_downloadFolderCommand","downloadPath","projectName","basename","DOWNLOADING_FILE","zipFolder","zip","generateAsync","blob","saveAs","_downloadCommand","entryToDownload","fileOrFolder","isFile","read","encoding","BYTE_ARRAY_ENCODING","blobContent","Blob","EVENT_FS_RENAME_STARTED","RENAMING","EVENT_FS_RENAME_END","OPERATION_CUT","OPERATION_COPY","_registerPathWithClipboard","operation","clipboardText","copyToClipboard","PhStore","setItem","getProjectRelativePath","projectRootParent","relativePath","relative","displayPath","getMountDir","getTauriDir","getTauriPlatformPath","_getVirtualDocumentsDirectory","_copyProjectRelativePath","pathToCopy","_cutFileCMD","_copyFileCMD","_getPasteTarget","dstThatExists","parentEntry","_isSameOrSubPathOf","dir","subDir","isAbsolute","_validatePasteTarget","srcEntry","targetEntry","baseName","targetPath","existsAsync","_performCut","src","dst","target","canPaste","MOVING","rename","_performCopy","COPYING","targetStat","realPath","_pasteFileCMD","copiedFiles","clipboardReadFiles","copiedFileOrFolderPath","clipboardReadText","clipboard","getItem","_setProjectDownloadCommandEnabled","_event","FILE_DOWNLOAD_PROJECT","setEnabled","isLocalDiscPath","FILE_DOWNLOAD","htmlReady","watchExternalChanges","css","appendTo","click","jqEvent","classList","contains","getContextMenu","ContextMenuIds","PROJECT_MENU","preventDefault","originalEvent","dataTransfer","getData","stopPropagation","addScrollerShadow","makeEventDispatcher","stateManager","definePreference","UNSAFE_PROJECT_EXIT_PREFIX","_flagProjectNotExitedSafely","projectRootPath","persistDBForReboot","_flagProjectExitedSafely","removeItem","unsafeExit","_entryToPathSet","entryArray","Set","map","_evt","addedSet","removedSet","size","startupFilesLoaded","isStartupFilesLoaded","FILE_EXISTS_ERR","ERROR_NOT_IN_PROJECT","ERROR_MOVING_NOT_IN_PROJECT","ERROR_RENAMING_NOT_IN_PROJECT","getAllFiles","includeWorkingSet","sort","options","viewFiles","deferred","getWorkingSet","scope","fileList","addIconProvider","callback","priority","rerenderTree","addClassesProvider","addClassProvider","on_duringInit","register","CMD_OPEN_FOLDER","FILE_OPEN_FOLDER","CMD_PROJECT_SETTINGS","FILE_PROJECT_SETTINGS","CMD_FILE_REFRESH","FILE_REFRESH","CMD_FILE_CUT","FILE_CUT","CMD_FILE_COPY","FILE_COPY","CMD_FILE_COPY_PATH","FILE_COPY_PATH","CMD_FILE_PASTE","FILE_PASTE","CMD_FILE_DUPLICATE","FILE_DUPLICATE","CMD_FILE_DUPLICATE_FILE","FILE_DUPLICATE_FILE","CMD_FILE_DOWNLOAD_PROJECT","CMD_FILE_DOWNLOAD","description","DESCRIPTION_SORT_DIRECTORIES_FIRST","sortPref","FILE_SHOW_FOLDERS_FIRST","setChecked","CMD_FILE_SHOW_FOLDERS_FIRST","_actionCreator","shouldShow","shouldIndex","shouldShowFileNameInTree"],"mappings":"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","sourcesContent":["/*\n * GNU AGPL-3.0 License\n *\n * Copyright (c) 2021 - present core.ai . All rights reserved.\n * Original work Copyright (c) 2012 - 2021 Adobe Systems Incorporated. All rights reserved.\n *\n * This program is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful, but WITHOUT\n * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n * for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with this program. If not, see https://opensource.org/licenses/AGPL-3.0.\n *\n */\n\n/**\n * ProjectManager glues together the project model and file tree view and integrates as needed with other parts\n * of Brackets. It is responsible for creating and updating the project tree when projects are opened\n * and when changes occur to the file tree.\n *\n * This module dispatches these events:\n *    - beforeProjectClose -- before `_projectRoot` changes, but working set files still open\n *    - projectClose       -- *just* before `_projectRoot` changes; working set already cleared\n *      & project root unwatched\n *    - beforeAppClose     -- before Brackets quits entirely\n *    - projectOpen        -- after `_projectRoot` changes and the tree is re-rendered\n *    - projectRefresh     -- when project tree is re-rendered for a reason other than\n *      a project being opened (e.g. from the Refresh command)\n *\n * To listen for events, do something like this: (see EventDispatcher for details on this pattern)\n *    ProjectManager.on(\"eventname\", handler);\n */\n\n/*global Phoenix, path*/\n\ndefine(function (require, exports, module) {\n\n\n    require(\"utils/Global\");\n\n    const _ = require(\"thirdparty/lodash\");\n\n    // Load dependent modules\n    const AppInit             = require(\"utils/AppInit\"),\n        Async               = require(\"utils/Async\"),\n        PreferencesDialogs  = require(\"preferences/PreferencesDialogs\"),\n        PreferencesManager  = require(\"preferences/PreferencesManager\"),\n        DocumentManager     = require(\"document/DocumentManager\"),\n        MainViewManager     = require(\"view/MainViewManager\"),\n        CommandManager      = require(\"command/CommandManager\"),\n        Commands            = require(\"command/Commands\"),\n        Dialogs             = require(\"widgets/Dialogs\"),\n        DefaultDialogs      = require(\"widgets/DefaultDialogs\"),\n        EventDispatcher     = require(\"utils/EventDispatcher\"),\n        LanguageManager     = require(\"language/LanguageManager\"),\n        Menus               = require(\"command/Menus\"),\n        StringUtils         = require(\"utils/StringUtils\"),\n        Strings             = require(\"strings\"),\n        FileSystem          = require(\"filesystem/FileSystem\"),\n        FileViewController  = require(\"project/FileViewController\"),\n        PerfUtils           = require(\"utils/PerfUtils\"),\n        FileUtils           = require(\"file/FileUtils\"),\n        FileSystemError     = require(\"filesystem/FileSystemError\"),\n        Urls                = require(\"i18n!nls/urls\"),\n        FileSyncManager     = require(\"project/FileSyncManager\"),\n        ProjectModel        = require(\"project/ProjectModel\"),\n        FileTreeView        = require(\"project/FileTreeView\"),\n        WorkingSetView      = require(\"project/WorkingSetView\"),\n        ViewUtils           = require(\"utils/ViewUtils\"),\n        ZipUtils            = require(\"utils/ZipUtils\"),\n        Metrics             = require(\"utils/Metrics\");\n\n    // Needed to ensure that menus are set up when we need them.\n    // See #10115\n    require(\"command/DefaultMenus\");\n\n    const EVENT_PROJECT_BEFORE_CLOSE = \"beforeProjectClose\",\n        EVENT_PROJECT_CLOSE = \"projectClose\",\n        EVENT_PROJECT_OPEN_FAILED = \"projectFileOpenFailed\",\n        EVENT_PROJECT_OPEN = \"projectOpen\",\n        EVENT_AFTER_PROJECT_OPEN = \"afterProjectOpen\",\n        // on boot, we load files that have been passed in from os either with `open with` from os file explorer or\n        // as cli from terminal. EVENT_AFTER_STARTUP_FILES_LOADED is trigerred after those files have been loaded.\n        // Note that this may be trigerred before any extensions get loaded, so always a good idea to check for\n        // isStartupFilesLoaded()\n        EVENT_AFTER_STARTUP_FILES_LOADED = \"startupFilesLoaded\",\n        EVENT_PROJECT_REFRESH = \"projectRefresh\",\n        EVENT_CONTENT_CHANGED = \"contentChanged\",\n        // This will capture all file/folder changes in projects except renames. If you want to track renames,\n        // use EVENT_PROJECT_PATH_CHANGED_OR_RENAMED to track all changes or EVENT_PROJECT_FILE_RENAMED too.\n        EVENT_PROJECT_FILE_CHANGED = \"projectFileChanged\",\n        EVENT_PROJECT_FILE_RENAMED = \"projectFileRenamed\",\n        // the path changed event differs in the sense that all events returned by this will be a path.\n        EVENT_PROJECT_CHANGED_OR_RENAMED_PATH = \"projectChangedPath\";\n\n    EventDispatcher.setLeakThresholdForEvent(EVENT_PROJECT_OPEN, 25);\n\n    const CLIPBOARD_SYNC_KEY = \"phoenix.clipboard\";\n\n    /**\n     * @private\n     * Filename to use for project settings files.\n     * @type {string}\n     */\n    const SETTINGS_FILENAME = \".\" + PreferencesManager.SETTINGS_FILENAME,\n        SETTINGS_FILENAME_BRACKETS = \".\" + PreferencesManager.SETTINGS_FILENAME_BRACKETS;\n\n    /**\n     * Name of the preferences for sorting directories first\n     *\n     * @type {string}\n     */\n    var SORT_DIRECTORIES_FIRST = \"sortDirectoriesFirst\";\n\n    /**\n     * @private\n     * Forward declarations to make JSLint happy.\n     */\n    var _fileSystemChange,\n        _fileSystemRename,\n        _showErrorDialog,\n        _saveTreeState,\n        _renderTreeSync,\n        _renderTree;\n\n    /**\n     * @const\n     * @private\n     * Error context to show the correct error message\n     * @type {int}\n     */\n    const ERR_TYPE_CREATE                 = 1,\n        ERR_TYPE_CREATE_EXISTS          = 2,\n        ERR_TYPE_RENAME                 = 3,\n        ERR_TYPE_DELETE                 = 4,\n        ERR_TYPE_LOADING_PROJECT        = 5,\n        ERR_TYPE_LOADING_PROJECT_NATIVE = 6,\n        ERR_TYPE_MAX_FILES              = 7,\n        ERR_TYPE_OPEN_DIALOG            = 8,\n        ERR_TYPE_INVALID_FILENAME       = 9,\n        ERR_TYPE_MOVE                   = 10,\n        ERR_TYPE_PASTE                  = 11,\n        ERR_TYPE_PASTE_FAILED           = 12,\n        ERR_TYPE_DUPLICATE_FAILED       = 13,\n        ERR_TYPE_DOWNLOAD_FAILED       = 14;\n\n    /**\n     * @private\n     * Reference to the tree control container div. Initialized by\n     * htmlReady handler\n     * @type {jQueryObject}\n     */\n    var $projectTreeContainer;\n\n    /**\n     * @private\n     *\n     * Reference to the container of the Preact component. Everything in this\n     * node is managed by Preact.\n     * @type {Element}\n     */\n    var fileTreeViewContainer;\n\n    /**\n     * @private\n     *\n     * Does the file tree currently have the focus?\n     *\n     * @return {boolean} `true` if the file tree has the focus\n     */\n    function _hasFileSelectionFocus() {\n        return FileViewController.getFileSelectionFocus() === FileViewController.PROJECT_MANAGER;\n    }\n\n    /**\n     * @private\n     * Singleton ProjectModel object.\n     * @type {ProjectModel.ProjectModel}\n     */\n    var model = new ProjectModel.ProjectModel({\n        focused: _hasFileSelectionFocus()\n    });\n\n    /**\n     * @private\n     * @type {boolean}\n     * A flag to remember when user has been warned about too many files, so they\n     * are only warned once per project/session.\n     */\n    var _projectWarnedForTooManyFiles = false;\n\n    /**\n     * @private\n     *\n     * Event handler which displays an error based on a problem creating a file.\n     *\n     * @param {$.Event} e jQuery event object\n     * @param {{type:any,isFolder:boolean}} errorInfo Information passed in the error events\n     */\n    function _displayCreationError(e, errorInfo) {\n        window.setTimeout(function () {\n            var error = errorInfo.type,\n                isFolder = errorInfo.isFolder,\n                name = errorInfo.name;\n\n            if (error === FileSystemError.ALREADY_EXISTS) {\n                _showErrorDialog(ERR_TYPE_CREATE_EXISTS, isFolder, null, name);\n            } else if (error === ProjectModel.ERROR_INVALID_FILENAME) {\n                _showErrorDialog(ERR_TYPE_INVALID_FILENAME, isFolder, ProjectModel._invalidChars);\n            } else {\n                var errString = error === FileSystemError.NOT_WRITABLE ?\n                        Strings.NO_MODIFICATION_ALLOWED_ERR :\n                        StringUtils.format(Strings.GENERIC_ERROR, error);\n\n                _showErrorDialog(ERR_TYPE_CREATE, isFolder, errString, name).getPromise();\n            }\n        }, 10);\n    }\n\n    /**\n     * @private\n     *\n     * Reverts to the previous selection (useful if there's an error).\n     *\n     * @param {string|File} previousPath The previously selected path.\n     * @param {boolean} switchToWorkingSet True if we need to switch focus to the Working Set\n     */\n    function _revertSelection(previousPath, switchToWorkingSet) {\n        model.setSelected(previousPath);\n        if (switchToWorkingSet) {\n            FileViewController.setFileViewFocus(FileViewController.WORKING_SET_VIEW);\n        }\n    }\n\n    /**\n     * @constructor\n     * @private\n     *\n     * Manages the interaction between the view and the model. This is loosely structured in\n     * the style of [Flux](https://github.com/facebook/flux), but the initial implementation did\n     * not need all of the parts of Flux yet. This ActionCreator could be replaced later with\n     * a real ActionCreator that talks to a Dispatcher.\n     *\n     * Most of the methods just delegate to the ProjectModel. Some are responsible for integration\n     * with other parts of Brackets.\n     *\n     * @param {ProjectModel} model store (in Flux terminology) with the project data\n     */\n    function ActionCreator(model) {\n        this.model = model;\n        this._bindEvents();\n    }\n\n    /**\n     * @private\n     *\n     * Listen to events on the ProjectModel and cause the appropriate behavior within the rest of the system.\n     */\n    ActionCreator.prototype._bindEvents = function () {\n\n        // Change events are the standard Flux signal to rerender the view. Note that\n        // current Flux style is to have the view itself listen to the Store for change events\n        // and re-render itself.\n        this.model.on(ProjectModel.EVENT_CHANGE, function () {\n            _renderTree();\n        });\n\n        // The \"should select\" event signals that we need to open the document based on file tree\n        // activity.\n        this.model.on(ProjectModel.EVENT_SHOULD_SELECT, function (e, data) {\n            if (data.add) {\n                FileViewController.openFileAndAddToWorkingSet(data.path).fail(_.partial(_revertSelection, data.previousPath, !data.hadFocus));\n            } else {\n                FileViewController.openAndSelectDocument(data.path, FileViewController.PROJECT_MANAGER).fail(_.partial(_revertSelection, data.previousPath, !data.hadFocus));\n            }\n        });\n\n        this.model.on(ProjectModel.EVENT_SHOULD_FOCUS, function () {\n            FileViewController.setFileViewFocus(FileViewController.PROJECT_MANAGER);\n        });\n\n        this.model.on(ProjectModel.ERROR_CREATION, _displayCreationError);\n    };\n\n    /**\n     * Sets the directory at the given path to open in the tree and saves the open nodes to view state.\n     *\n     * See `ProjectModel.setDirectoryOpen`\n     */\n    ActionCreator.prototype.setDirectoryOpen = function (path, open) {\n        this.model.setDirectoryOpen(path, open).then(_saveTreeState);\n    };\n\n    /**\n     * See `ProjectModel.setSelected`\n     */\n    ActionCreator.prototype.setSelected = function (path, doNotOpen) {\n        this.model.setSelected(path, doNotOpen);\n    };\n\n    /**\n     * See `ProjectModel.selectInWorkingSet`\n     */\n    ActionCreator.prototype.selectInWorkingSet = function (path) {\n        this.model.selectInWorkingSet(path);\n    };\n\n    /**\n     * See `FileViewController.openWithExternalApplication`\n     */\n    ActionCreator.prototype.openWithExternalApplication = function (path) {\n        FileViewController.openWithExternalApplication(path);\n    };\n\n\n    /**\n     * See `ProjectModel.setContext`\n     */\n    ActionCreator.prototype.setContext = function (path) {\n        this.model.setContext(path);\n    };\n\n    /**\n     * See `ProjectModel.restoreContext`\n     */\n    ActionCreator.prototype.restoreContext = function () {\n        this.model.restoreContext();\n    };\n\n    /**\n     * See `ProjectModel.startRename`\n     */\n    ActionCreator.prototype.startRename = function (path, isMoved) {\n        // This is very not Flux-like, which is a sign that Flux may not be the\n        // right choice here *or* that this architecture needs to evolve subtly\n        // in how errors are reported (more like the create case).\n        // See #9284.\n        renameItemInline(path, isMoved);\n    };\n\n    /**\n     * See `ProjectModel.setRenameValue`\n     */\n    ActionCreator.prototype.setRenameValue = function (path) {\n        this.model.setRenameValue(path);\n    };\n\n    /**\n     * See `ProjectModel.cancelRename`\n     */\n    ActionCreator.prototype.cancelRename = function () {\n        this.model.cancelRename();\n    };\n\n    /**\n     * See `ProjectModel.performRename`\n     */\n    ActionCreator.prototype.performRename = function () {\n        return this.model.performRename();\n    };\n\n    /**\n     * See `ProjectModel.startCreating`\n     */\n    ActionCreator.prototype.startCreating = function (basedir, newName, isFolder) {\n        return this.model.startCreating(basedir, newName, isFolder);\n    };\n\n    /**\n     * See `ProjectModel.setSortDirectoriesFirst`\n     */\n    ActionCreator.prototype.setSortDirectoriesFirst = function (sortDirectoriesFirst) {\n        this.model.setSortDirectoriesFirst(sortDirectoriesFirst);\n    };\n\n    /**\n     * See `ProjectModel.setFocused`\n     */\n    ActionCreator.prototype.setFocused = function (focused) {\n        this.model.setFocused(focused);\n    };\n\n    /**\n     * See `ProjectModel.setCurrentFile`\n     */\n    ActionCreator.prototype.setCurrentFile = function (curFile) {\n        this.model.setCurrentFile(curFile);\n    };\n\n    /**\n     * See `ProjectModel.toggleSubdirectories`\n     */\n    ActionCreator.prototype.toggleSubdirectories = function (path, openOrClose) {\n        this.model.toggleSubdirectories(path, openOrClose).then(_saveTreeState);\n    };\n\n    /**\n     * See `ProjectModel.closeSubtree`\n     */\n    ActionCreator.prototype.closeSubtree = function (path) {\n        this.model.closeSubtree(path);\n        _saveTreeState();\n    };\n\n    ActionCreator.prototype.dragItem = function (path) {\n        // Close open menus on drag and clear the context, but only if there's a menu open.\n        if ($(\".dropdown.open\").length > 0) {\n            Menus.closeAll();\n            this.setContext(null);\n        }\n\n        // Close directory, if dragged item is directory\n        if (_.last(path) === '/') {\n            this.setDirectoryOpen(path, false);\n        }\n    };\n\n    /**\n     * Moves the item in the oldPath to the newDirectory directory\n     */\n    ActionCreator.prototype.moveItem = function (oldPath, newDirectory) {\n        var fileName = FileUtils.getBaseName(oldPath),\n            newPath = newDirectory + fileName,\n            self = this;\n\n        // If item dropped onto itself or onto its parent directory, return\n        if (oldPath === newDirectory || FileUtils.getParentPath(oldPath) === newDirectory) {\n            return;\n        }\n\n        // Add trailing slash if directory is moved\n        if (_.last(oldPath) === '/') {\n            newPath = ProjectModel._ensureTrailingSlash(newPath);\n        }\n\n        this.startRename(oldPath, true);\n        this.setRenameValue(newPath);\n\n        this.performRename();\n        this.setDirectoryOpen(newDirectory, true);\n    };\n\n    /**\n     * See `ProjectModel.refresh`\n     */\n    ActionCreator.prototype.refresh = function () {\n        this.model.refresh();\n    };\n\n    /**\n     * @private\n     * @type {ActionCreator}\n     *\n     * Singleton actionCreator that is used for dispatching changes to the ProjectModel.\n     */\n    var actionCreator = new ActionCreator(model);\n\n    /**\n     * Returns the File or Directory corresponding to the item that was right-clicked on in the file tree menu.\n     * @return {?(File|Directory)}\n     */\n    function getFileTreeContext() {\n        var selectedEntry = model.getContext();\n        return selectedEntry;\n    }\n\n    /**\n     * Returns the File or Directory corresponding to the item selected in the sidebar panel, whether in\n     * the file tree OR in the working set; or null if no item is selected anywhere in the sidebar.\n     * May NOT be identical to the current Document - a folder may be selected in the sidebar, or the sidebar may not\n     * have the current document visible in the tree & working set.\n     * @return {?(File|Directory)}\n     */\n    function getSelectedItem() {\n        // Prefer file tree context, then file tree selection, else use working set\n        var selectedEntry = getFileTreeContext();\n        if (!selectedEntry) {\n            selectedEntry = model.getSelected();\n        }\n        if (!selectedEntry) {\n            selectedEntry = MainViewManager.getCurrentlyViewedFile();\n        }\n        return selectedEntry;\n    }\n\n    /**\n     * @private\n     *\n     * Handler for changes in the focus between working set and file tree view.\n     */\n    function _fileViewControllerChange() {\n        actionCreator.setFocused(_hasFileSelectionFocus());\n        _renderTree();\n    }\n\n    /**\n     * @private\n     *\n     * Handler for changes in document selection.\n     */\n    function _documentSelectionFocusChange() {\n        var curFullPath = MainViewManager.getCurrentlyViewedPath(MainViewManager.ACTIVE_PANE);\n        if (curFullPath && _hasFileSelectionFocus()) {\n            actionCreator.setSelected(curFullPath, true);\n        } else {\n            actionCreator.setSelected(null);\n        }\n        _fileViewControllerChange();\n    }\n\n    /**\n     * @private\n     *\n     * Handler for changes to which file is currently viewed.\n     *\n     * @param {Object} e jQuery event object\n     * @param {File} curFile Currently viewed file.\n     */\n    function _currentFileChange(e, curFile) {\n        actionCreator.setCurrentFile(curFile);\n    }\n\n    /**\n     * Returns the encoded Base URL of the currently loaded project, or empty string if no project\n     * is open (during startup, or running outside of app shell).\n     * @return {String}\n     */\n    function getBaseUrl() {\n        return model.getBaseUrl();\n    }\n\n    /**\n     * Sets the encoded Base URL of the currently loaded project.\n     * @param {String}\n     */\n    function setBaseUrl(projectBaseUrl) {\n        projectBaseUrl = model.setBaseUrl(projectBaseUrl);\n\n        PreferencesManager.setViewState(\"project.baseUrl\", projectBaseUrl, PreferencesManager.STATE_PROJECT_CONTEXT);\n    }\n\n    /**\n     * Returns true if absPath lies within the project, false otherwise.\n     * Does not support paths containing \"..\"\n     * @param {string|FileSystemEntry} absPathOrEntry\n     * @return {boolean}\n     */\n    function isWithinProject(absPathOrEntry) {\n        return model.isWithinProject(absPathOrEntry);\n    }\n\n    /**\n     * Returns an array of files that is within the project from the supplied list of paths.\n     * @param {string|FileSystemEntry[]} absPathOrEntryArray array which can be either a string path or FileSystemEntry\n     * @return {string|FileSystemEntry[]} A array that contains only files paths that are in the project\n     */\n    function filterProjectFiles(absPathOrEntryArray) {\n        if(!absPathOrEntryArray){\n            return absPathOrEntryArray;\n        }\n        let filteredPaths = [];\n        absPathOrEntryArray.forEach(function (file) {\n            if(isWithinProject(file)){\n                filteredPaths.push(file);\n            }\n        });\n        return filteredPaths;\n    }\n\n    /**\n     * If absPath lies within the project, returns a project-relative path. Else returns absPath\n     * unmodified.\n     * Does not support paths containing \"..\"\n     * @param {!string} absPath\n     * @return {!string}\n     */\n    function makeProjectRelativeIfPossible(absPath) {\n        return model.makeProjectRelativeIfPossible(absPath);\n    }\n\n    /**\n     * Gets a generally displayable path that can be shown to the user in most cases.\n     * Gets the project relative path if possible. If paths is not in project, then if its a platform path(Eg. in tauri)\n     * it will return the full platform path. If not, then it will return a mount relative path for fs access mount\n     * folders opened in the bowser. at last, falling back to vfs path. This should only be used for display purposes\n     * as this path will be changed by phcode depending on the situation in the future.\n     * @param fullPath\n     * @returns {string}\n     */\n    function getProjectRelativeOrDisplayPath(fullPath) {\n        return Phoenix.app.getDisplayPath(makeProjectRelativeIfPossible(fullPath));\n    }\n\n    /**\n     * Returns the root folder of the currently loaded project, or null if no project is open (during\n     * startup, or running outside of app shell).\n     * @return {Directory}\n     */\n    function getProjectRoot() {\n        return model.projectRoot;\n    }\n\n    /**\n     * @private\n     *\n     * Sets the project root to the given directory, resetting the ProjectModel and file tree in the process.\n     *\n     * @param {Directory} rootEntry directory object for the project root\n     * @return {$.Promise} resolved when the project is done setting up\n     */\n    function _setProjectRoot(rootEntry) {\n        var d = new $.Deferred();\n        model.setProjectRoot(rootEntry).then(function () {\n            d.resolve();\n            model.reopenNodes(PreferencesManager.getViewState(\"project.treeState\", PreferencesManager.STATE_PROJECT_CONTEXT));\n        });\n        return d.promise();\n    }\n\n    /**\n     * @private\n     *\n     * Saves the project path.\n     */\n    var _saveProjectPath = function () {\n        // save the current project\n        PreferencesManager.setViewState(\"projectPath\", model.projectRoot.fullPath);\n    };\n\n    /**\n     * @private\n     * Save tree state.\n     */\n    _saveTreeState = function () {\n        const openNodes = model.getOpenNodes();\n\n        // Store the open nodes by their full path and persist to storage\n        PreferencesManager.setViewState(\"project.treeState\", openNodes, PreferencesManager.STATE_PROJECT_CONTEXT);\n    };\n\n    /**\n     * @private\n     *\n     * Displays an error dialog for problems when working with files in the file tree.\n     *\n     * @param {number} errType type of error that occurred\n     * @param {boolean} isFolder did the error occur because of a folder operation?\n     * @param {string} error message with detail about the error\n     * @param {string} path path to file or folder that had the error\n     * @return {Dialog|null} Dialog if the error message was created\n     */\n    _showErrorDialog = function (errType, isFolder, error, path, dstPath) {\n        var titleType = isFolder ? Strings.DIRECTORY_TITLE : Strings.FILE_TITLE,\n            entryType = isFolder ? Strings.DIRECTORY : Strings.FILE,\n            title,\n            message;\n        path = StringUtils.breakableUrl(path);\n\n        switch (errType) {\n        case ERR_TYPE_CREATE:\n            title = StringUtils.format(Strings.ERROR_CREATING_FILE_TITLE, titleType);\n            message = StringUtils.format(Strings.ERROR_CREATING_FILE, entryType, path, error);\n            break;\n        case ERR_TYPE_CREATE_EXISTS:\n            title = StringUtils.format(Strings.INVALID_FILENAME_TITLE, titleType);\n            message = StringUtils.format(Strings.ENTRY_WITH_SAME_NAME_EXISTS, path);\n            break;\n        case ERR_TYPE_RENAME:\n            title = StringUtils.format(Strings.ERROR_RENAMING_FILE_TITLE, titleType);\n            message = StringUtils.format(Strings.ERROR_RENAMING_FILE, path, error, entryType);\n            break;\n        case ERR_TYPE_MOVE:\n            title = StringUtils.format(Strings.ERROR_MOVING_FILE_TITLE, titleType);\n            message = StringUtils.format(Strings.ERROR_MOVING_FILE, path, error, entryType);\n            break;\n        case ERR_TYPE_DELETE:\n            title = StringUtils.format(Strings.ERROR_DELETING_FILE_TITLE, titleType);\n            message = StringUtils.format(Strings.ERROR_DELETING_FILE, path, error, entryType);\n            break;\n        case ERR_TYPE_LOADING_PROJECT:\n            title = Strings.ERROR_LOADING_PROJECT;\n            message = StringUtils.format(Strings.READ_DIRECTORY_ENTRIES_ERROR, path, error);\n            break;\n        case ERR_TYPE_LOADING_PROJECT_NATIVE:\n            title = Strings.ERROR_LOADING_PROJECT;\n            message = StringUtils.format(Strings.REQUEST_NATIVE_FILE_SYSTEM_ERROR, path, error);\n            break;\n        case ERR_TYPE_MAX_FILES:\n            title = Strings.ERROR_MAX_FILES_TITLE;\n            message = Strings.ERROR_MAX_FILES;\n            break;\n        case ERR_TYPE_OPEN_DIALOG:\n            title = Strings.ERROR_LOADING_PROJECT;\n            message = StringUtils.format(Strings.OPEN_DIALOG_ERROR, error);\n            break;\n        case ERR_TYPE_INVALID_FILENAME:\n            title = StringUtils.format(Strings.INVALID_FILENAME_TITLE, isFolder ? Strings.DIRECTORY_NAME : Strings.FILENAME);\n            message = StringUtils.format(Strings.INVALID_FILENAME_MESSAGE, isFolder ? Strings.DIRECTORY_NAMES_LEDE : Strings.FILENAMES_LEDE, error);\n            break;\n        case ERR_TYPE_PASTE:\n            title = StringUtils.format(Strings.CANNOT_PASTE_TITLE, titleType);\n            message = StringUtils.format(Strings.ENTRY_WITH_SAME_NAME_EXISTS, path);\n            break;\n        case ERR_TYPE_PASTE_FAILED:\n            title = StringUtils.format(Strings.CANNOT_PASTE_TITLE, titleType);\n            message = StringUtils.format(Strings.ERR_TYPE_PASTE_FAILED, path, dstPath);\n            break;\n        case ERR_TYPE_DUPLICATE_FAILED:\n            title = StringUtils.format(Strings.CANNOT_DUPLICATE_TITLE, titleType);\n            message = StringUtils.format(Strings.ERR_TYPE_DUPLICATE_FAILED, path);\n            break;\n        case ERR_TYPE_DOWNLOAD_FAILED:\n            title = StringUtils.format(Strings.CANNOT_DOWNLOAD_TITLE, titleType);\n            message = StringUtils.format(Strings.ERR_TYPE_DOWNLOAD_FAILED, path);\n            break;\n        }\n\n        if (title && message) {\n            return Dialogs.showModalDialog(\n                DefaultDialogs.DIALOG_ID_ERROR,\n                title,\n                message\n            );\n        }\n        return null;\n    };\n\n    var _RENDER_DEBOUNCE_TIME = 100;\n\n    /**\n     * @private\n     *\n     * Rerender the file tree view.\n     *\n     * @param {boolean} forceRender Force the tree to rerender. Should only be needed by extensions that call rerenderTree.\n     */\n    _renderTreeSync = function (forceRender) {\n        var projectRoot = getProjectRoot();\n        if (!projectRoot) {\n            return;\n        }\n        model.setScrollerInfo($projectTreeContainer[0].scrollWidth, $projectTreeContainer.scrollTop(), $projectTreeContainer.scrollLeft(), $projectTreeContainer.offset().top);\n        FileTreeView.render(fileTreeViewContainer, model._viewModel, projectRoot, actionCreator, forceRender, brackets.platform);\n    };\n\n    _renderTree = _.debounce(_renderTreeSync, _RENDER_DEBOUNCE_TIME);\n\n    /**\n     * @private\n     *\n     * Returns the full path to the welcome project, which we open on first launch.\n     *\n     * @param {string} sampleUrl URL for getting started project\n     * @param {string} initialPath Path to Brackets directory (see FileUtils.getNativeBracketsDirectoryPath())\n     * @return {!string} fullPath reference\n     */\n    function getWelcomeProjectPath() {\n        return ProjectModel._ensureTrailingSlash(Phoenix.VFS.getDefaultProjectDir());\n    }\n\n    function getPlaceholderProjectPath() {\n        return \"/no_project_loaded/\";\n    }\n\n    function getExploreProjectPath() {\n        return `${getLocalProjectsPath()}explore/`;\n    }\n\n    /**\n     * The flder where all the system managed projects live\n     * @returns {string}\n     */\n    function getLocalProjectsPath() {\n        return Phoenix.VFS.getUserProjectsDirectory();\n    }\n\n    /**\n     * Adds the path to the list of welcome projects we've ever seen, if not on the list already.\n     *\n     * @param {string} path Path to possibly add\n     */\n    function addWelcomeProjectPath(path) {\n        var welcomeProjects = ProjectModel._addWelcomeProjectPath(path,\n            PreferencesManager.getViewState(\"welcomeProjects\"));\n        PreferencesManager.setViewState(\"welcomeProjects\", welcomeProjects);\n    }\n\n\n    /**\n     * Returns true if the given path is the same as one of the welcome projects we've previously opened,\n     * or the one for the current build.\n     *\n     * @param {string} path Path to check to see if it's a welcome project path\n     * @return {boolean} true if this is a welcome project path\n     */\n    function isWelcomeProjectPath(path) {\n        return ProjectModel._isWelcomeProjectPath(path, getWelcomeProjectPath(), PreferencesManager.getViewState(\"welcomeProjects\"));\n    }\n\n    /**\n     * If the provided path is to an old welcome project, returns the current one instead.\n     */\n    function updateWelcomeProjectPath(path) {\n        if (isWelcomeProjectPath(path)) {\n            return getWelcomeProjectPath();\n        }\n        return path;\n\n    }\n\n    /**\n     * @deprecated use getStartupProjectPath instead. Can be removed anytime after 2-Apr-2023.\n     * Initial project path is stored in prefs, which defaults to the welcome project on\n     * first launch.\n     */\n    function getInitialProjectPath() {\n        return updateWelcomeProjectPath(PreferencesManager.getViewState(\"projectPath\"));\n    }\n\n    async function _dirExists(fullPath) {\n        try {\n            const {entry} = await FileSystem.resolveAsync(fullPath);\n            return entry.isDirectory;\n        } catch (e) {\n            return false;\n        }\n    }\n\n    async function _safeCheckFolder(absOrRelativePath, relativeToDir=null) {\n        try{\n            let folderToOpen;\n            if(!relativeToDir){\n                folderToOpen = Phoenix.VFS.getTauriVirtualPath(absOrRelativePath);\n                const dirExists = await _dirExists(folderToOpen);\n                if(dirExists){\n                    return folderToOpen;\n                }\n            } else {\n                folderToOpen = window.path.join(Phoenix.VFS.getTauriVirtualPath(relativeToDir), absOrRelativePath);\n                const dirExists = await _dirExists(folderToOpen);\n                if(dirExists){\n                    return folderToOpen;\n                }\n            }\n        } catch (e) {\n            console.warn(\"error opening folder at path\", absOrRelativePath, relativeToDir);\n        }\n        return null;\n    }\n\n    async function _getStartupProjectFromCLIArgs() {\n        const cliArgs= await Phoenix.app.getCommandLineArgs();\n        const args = cliArgs && cliArgs.args,\n            cwd = cliArgs && cliArgs.cwd;\n        if(!args || args.length <= 1){ // the second arg is the folder we have to open\n            return null;\n        }\n        try{\n            let folderToOpen = args[1];\n            folderToOpen = await _safeCheckFolder(args[1]);\n            if(folderToOpen){\n                Metrics.countEvent(Metrics.EVENT_TYPE.PLATFORM, 'openWith', \"folder\");\n                return folderToOpen;\n            }\n            folderToOpen = await _safeCheckFolder(args[1], cwd);\n            if(folderToOpen){\n                Metrics.countEvent(Metrics.EVENT_TYPE.PLATFORM, 'openWith', \"folder\");\n            }\n            return folderToOpen;\n        } catch (e) {\n            console.error(\"Error getting startupProjectPath from CLI args\", e);\n        }\n        return null;\n    }\n\n    /**\n     * Initial project path is stored in prefs, which defaults to the welcome project on\n     * first launch.\n     */\n    async function getStartupProjectPath() {\n        let startupProjectPath = await _getStartupProjectFromCLIArgs();\n        if(startupProjectPath){\n            return startupProjectPath;\n        }\n        startupProjectPath = updateWelcomeProjectPath(PreferencesManager.getViewState(\"projectPath\"));\n        if(startupProjectPath && _isProjectSafeToStartup(startupProjectPath)){\n            const dirExists = await _dirExists(startupProjectPath);\n            if(dirExists){\n                return startupProjectPath;\n            }\n        }\n        return getWelcomeProjectPath();\n    }\n\n    function _mergeProjectGitIgnores(rootPath, gitIgnoreFilters) {\n        // this is an approximation to the gitIgnore spec to transform child git ignores to be\n        // relative to the project root.\n        let mergedGitIgnoreFile= \"\";\n        for(let filter of gitIgnoreFilters){\n            if(!filter.gitIgnoreContent){\n                continue;\n            }\n            const projectRelativePath = makeProjectRelativeIfPossible(filter.basePath);\n            if(!projectRelativePath){\n                // this is the .gitignore file in the root folder, do nothing.\n                mergedGitIgnoreFile = `${mergedGitIgnoreFile}\\n${filter.gitIgnoreContent}`;\n            } else {\n                let lines =[];\n                // Transform each line to be relative to the project directory\n                for(let line of filter.gitIgnoreContent.split('\\n')) {\n                    if (!line.trim() || line.startsWith('#')){\n                        lines.push(line); // empty lines and comments push as is\n                    } else {\n                        // Handle negated patterns like `!node_modules`\n                        const isNegated = line.startsWith('!');\n                        const pattern = isNegated ? line.substring(1) : line;\n                        // Patterns starting with a slash are relative to the .gitignore's directory\n                        if (line.startsWith('/')) {\n                            // Remove the leading '/' to correct the path for the new location\n                            lines.push(`${isNegated ? '!' : ''}${projectRelativePath}${pattern.substring(1)}`);\n                        } else {\n                            // For patterns without a leading '/', check if it's a directory-specific pattern\n                            if (line.endsWith('/') && (line.match(/\\//g) || []).length === 1) {\n                                // This checks both if the line ends with a slash\n                                // and if there's only one slash in the line, indicating it's\n                                // a top-level directory pattern.. Eg. `dir/`\n                                lines.push(`${isNegated ? '!' : ''}${projectRelativePath}**/${pattern}`);\n                            } else {\n                                // 1. this is a rule of the form `sub/dir/`, which should match exact sub dir\n                                // and children according to git spec\n                                // 2. For global patterns like `sub/dir/other` or `sub/dir/other.txt`\n                                lines.push(`${isNegated ? '!' : ''}${projectRelativePath}${pattern}`);\n                            }\n                        }\n                    }\n                }\n                mergedGitIgnoreFile = `${mergedGitIgnoreFile}\\n${lines.join('\\n')}`;\n            }\n        }\n        return mergedGitIgnoreFile;\n    }\n\n    /**\n     * @private\n     *\n     * Watches the project for filesystem changes so that the tree can be updated.\n     */\n    async function _watchProjectRoot(rootPath) {\n        FileSystem.on(\"change\", _fileSystemChange);\n        FileSystem.on(\"rename\", _fileSystemRename);\n        let gitIgnoreContent = _mergeProjectGitIgnores(rootPath, await model.computeProjectGitIgnoreAsync());\n        const gitIgnoreFilter = `${gitIgnoreContent}\\n${ProjectModel.defaultIgnoreGlobs.join(\"\\n\")}`;\n        FileSystem.watch(FileSystem.getDirectoryForPath(rootPath),\n            ProjectModel._shouldShowName, gitIgnoreFilter, function (err) {\n                if (err === FileSystemError.TOO_MANY_ENTRIES) {\n                    if (!_projectWarnedForTooManyFiles) {\n                        _showErrorDialog(ERR_TYPE_MAX_FILES);\n                        _projectWarnedForTooManyFiles = true;\n                    }\n                } else if (err) {\n                    console.error(\"Error watching project root: \", rootPath, err);\n                }\n        });\n\n        // Reset allFiles cache\n        model._resetCache();\n    }\n\n\n    /**\n     * @private\n     * Close the file system and remove listeners.\n     * @return {$.Promise} A promise that's resolved when the root is unwatched. Rejected if\n     *     there is no project root or if the unwatch fails.\n     */\n    function _unwatchProjectRoot() {\n        var result = new $.Deferred();\n        if (!model.projectRoot) {\n            result.reject();\n        } else {\n            FileSystem.off(\"change\", _fileSystemChange);\n            FileSystem.off(\"rename\", _fileSystemRename);\n\n            FileSystem.unwatch(model.projectRoot, function (err) {\n                if (err) {\n                    console.error(\"Error unwatching project root: \", model.projectRoot.fullPath, err);\n                    result.reject(err);\n                } else {\n                    result.resolve();\n                }\n            });\n\n            // Reset allFiles cache\n            model._resetCache();\n        }\n\n        return result.promise();\n    }\n\n    const PREF_OK = \"prefOK\",\n        PREF_JSON_ERR = \"jsonERR\",\n        PREF_NO_FILE = \"noFile\";\n    function _validateProjectPreferencesFile(filePath) {\n        return new Promise((resolve)=>{\n            const file   = FileSystem.getFileForPath(filePath);\n            FileUtils.readAsText(file)\n                .done(function (text) {\n                    try {\n                        if (text) {\n                            JSON.parse(text);\n                        }\n                        resolve(PREF_OK);\n                    } catch (err) {\n                        resolve(PREF_JSON_ERR);\n                    }\n                })\n                .fail(()=>{\n                    resolve(PREF_NO_FILE);\n                });\n        });\n    }\n\n    /**\n     * @private\n     * Reloads the project preferences.\n     */\n    async function _reloadProjectPreferencesScope() {\n        const root = getProjectRoot();\n        if (root) {\n            const phoenixPrefFile = root.fullPath + SETTINGS_FILENAME,\n                bracketsPrefFile = root.fullPath + SETTINGS_FILENAME_BRACKETS;\n            const statusPhoenix = await _validateProjectPreferencesFile(phoenixPrefFile);\n            const statusBrackets = await _validateProjectPreferencesFile(bracketsPrefFile);\n            let prefFileToUse = phoenixPrefFile;\n            if(statusPhoenix === PREF_NO_FILE && statusBrackets !== PREF_NO_FILE) {\n                prefFileToUse = bracketsPrefFile;\n            }\n            _alertBrokenPreferenceFile();\n            // Alias the \"project\" Scope to the path Scope for the project-level settings file\n            PreferencesManager._setProjectSettingsFile(prefFileToUse);\n        } else {\n            PreferencesManager._setProjectSettingsFile();\n        }\n    }\n\n    let alertIsShown = false;\n    async function _alertBrokenPreferenceFile() {\n        if(alertIsShown){\n            return;\n        }\n        //Verify that the project preferences file (.phcode.json or brackets.json) is NOT corrupted.\n        //If corrupted, display the error message and open the file in editor for the user to edit.\n        const root = getProjectRoot();\n        const phoenixPrefFile = root.fullPath + SETTINGS_FILENAME,\n            bracketsPrefFile = root.fullPath + SETTINGS_FILENAME_BRACKETS;\n        const statusPhoenix = await _validateProjectPreferencesFile(phoenixPrefFile);\n        const statusBrackets = await _validateProjectPreferencesFile(bracketsPrefFile);\n        let errorPrefFile = null;\n        if(statusPhoenix === PREF_JSON_ERR){\n            errorPrefFile = phoenixPrefFile;\n        } else if(statusPhoenix === PREF_NO_FILE && statusBrackets === PREF_JSON_ERR) {\n            errorPrefFile = bracketsPrefFile;\n        } else {\n            // no error/no pref file\n            return;\n        }\n        // Cannot parse the text read from the project preferences file.\n        const info = MainViewManager.findInAllWorkingSets(errorPrefFile);\n        let paneId;\n        if (info.length) {\n            paneId = info[0].paneId;\n        }\n        if(alertIsShown){ // due to async functions above, we have to check again\n            return;\n        }\n        alertIsShown = true;\n        FileViewController.openFileAndAddToWorkingSet(errorPrefFile, paneId)\n            .done(function () {\n                Dialogs.showModalDialog(\n                    DefaultDialogs.DIALOG_ID_ERROR,\n                    Strings.ERROR_PREFS_CORRUPT_TITLE,\n                    Strings.ERROR_PROJ_PREFS_CORRUPT\n                ).done(function () {\n                    // give the focus back to the editor with the pref file\n                    alertIsShown = false;\n                    MainViewManager.focusActivePane();\n                });\n            });\n    }\n\n    function _loadExistingProject(rootEntry) {\n        const rootPath = rootEntry.fullPath;\n        const result = new $.Deferred();\n        var projectRootChanged = (!model.projectRoot || !rootEntry) ||\n            model.projectRoot.fullPath !== rootEntry.fullPath;\n\n        // Success!\n        var perfTimerName = PerfUtils.markStart(\"Load Project: \" + rootPath);\n\n        _projectWarnedForTooManyFiles = false;\n\n        _setProjectRoot(rootEntry).always(function () {\n            model.setBaseUrl(PreferencesManager.getViewState(\"project.baseUrl\", PreferencesManager.STATE_PROJECT_CONTEXT) || \"\");\n\n            if (projectRootChanged) {\n                _reloadProjectPreferencesScope();\n                PreferencesManager._setCurrentFile(rootPath);\n            }\n            _watchProjectRoot(rootPath);\n\n            // If this is the most current welcome project, record it. In future launches, we want\n            // to substitute the latest welcome project from the current build instead of using an\n            // outdated one (when loading recent projects or the last opened project).\n            if (rootPath === getWelcomeProjectPath()) {\n                addWelcomeProjectPath(rootPath);\n            }\n\n            if (projectRootChanged) {\n                // Allow asynchronous event handlers to finish before resolving result by collecting promises from them\n                exports.trigger(EVENT_PROJECT_OPEN, model.projectRoot);\n                result.resolve();\n                exports.trigger(EVENT_AFTER_PROJECT_OPEN, model.projectRoot);\n            } else {\n                exports.trigger(EVENT_PROJECT_REFRESH, model.projectRoot);\n                result.resolve();\n            }\n            let projectLoadTime = PerfUtils.addMeasurement(perfTimerName);\n            Metrics.valueEvent(Metrics.EVENT_TYPE.PERFORMANCE, \"projectLoad\",\n                \"timeMs\", Number(projectLoadTime));\n        });\n        return result.promise();\n    }\n\n        const _SAMPLE_HTML = `<!DOCTYPE html>\n<html>\n    <head>\n        <title>Phoenix Editor for the web</title>\n    </head>\n\n    <body>\n        <h1>Welcome to Phoenix</h1>\n        <p> Modern, Open-source, IDE For The Web.</p>\n    </body>\n</html>`;\n\n    function _createDefaultProject() {\n        // Create phoenix app dirs\n        // Create Phoenix default project if it doesnt exist\n        return new Promise((resolve, reject)=>{\n            let projectDir = getWelcomeProjectPath();\n            Phoenix.VFS.exists(projectDir, (exists)=>{\n                if(exists) {\n                    resolve();\n                    return;\n                }\n                Phoenix.VFS.ensureExistsDir(projectDir, (err)=>{\n                    if(err){\n                        window.logger.reportError(err, \"Error creating default project\");\n                        reject(err);\n                        return;\n                    }\n                    let indexFile = Phoenix.VFS.path.normalize(`${projectDir}/index.html`);\n                    Phoenix.VFS.fs.writeFile(indexFile, _SAMPLE_HTML, 'utf8', ()=>{});\n                    resolve();\n                });\n            });\n        });\n    }\n\n    function _loadWelcomeProject() {\n        const welcomeProjectPath = getWelcomeProjectPath();\n        const result = new $.Deferred();\n        const rootEntry = FileSystem.getDirectoryForPath(welcomeProjectPath);\n        function _loadRootEntry() {\n            _loadExistingProject(rootEntry)\n                .done(result.resolve)\n                .fail(result.reject);\n        }\n        function _loadPlaceholderProject() {\n            // default project could not be created. As a last ditch effort to continue boot, we will\n            // use a vfs path `/no_project_loaded` to continue boot.\n            Phoenix.VFS.ensureExistsDir(getPlaceholderProjectPath(), (placeHolderErr)=>{\n                if(placeHolderErr){\n                    window.logger.reportError(placeHolderErr, \"Error creating /no_project_loaded\");\n                    alert(\"Unrecoverable error, startup project could not be created.\");\n                    return;\n                }\n                const placeholderProject = FileSystem.getDirectoryForPath(getPlaceholderProjectPath());\n                _loadExistingProject(placeholderProject)\n                    .done(result.resolve)\n                    .fail(result.reject);\n            });\n        }\n        rootEntry.exists(function (err, exists) {\n            if (exists) {\n                _loadRootEntry();\n            } else {\n                // create the welcome project only on first boot in desktop builds. The user may delete the phoenix\n                // project directory as he doesn't want phoenix folders in his documents. we should respect that.\n                if(Phoenix.isNativeApp && !Phoenix.firstBoot) {\n                    _loadPlaceholderProject();\n                    return;\n                }\n                _createDefaultProject()\n                    .then(_loadRootEntry)\n                    .catch(_loadPlaceholderProject);\n            }\n        });\n        return result.promise();\n    }\n\n    function _loadProjectInternal(rootPath) {\n        const result = new $.Deferred();\n        const rootEntry = FileSystem.getDirectoryForPath(rootPath);\n        rootEntry.exists(function (err, exists) {\n            if (exists) {\n                _loadExistingProject(rootEntry)\n                    .done(result.resolve)\n                    .fail(result.reject);\n            } else {\n                console.error(\"error loading project\");\n                exports.trigger(EVENT_PROJECT_OPEN_FAILED, rootPath);\n                _showErrorDialog(ERR_TYPE_LOADING_PROJECT_NATIVE, true, FileSystemError.NOT_FOUND, rootPath)\n                    .done(function () {\n                        // Reset _projectRoot to null so that the following _loadProject call won't\n                        // run the 'beforeProjectClose' event a second time on the original project,\n                        // which is now partially torn down (see #6574).\n                        model.projectRoot = null;\n\n                        _loadProject(getWelcomeProjectPath()).always(function () {\n                            // Make sure not to reject the original deferred until the fallback\n                            // project is loaded, so we don't violate expectations that there is always\n                            // a current project before continuing after _loadProject().\n                            result.reject();\n                        });\n                    });\n            }\n        });\n        return result.promise();\n    }\n\n    /**\n     * Loads the given folder as a project. Does NOT prompt about any unsaved changes - use openProject()\n     * instead to check for unsaved changes and (optionally) let the user choose the folder to open.\n     *\n     * @param {!string} rootPath  Absolute path to the root folder of the project.\n     *  A trailing \"/\" on the path is optional (unlike many Brackets APIs that assume a trailing \"/\").\n     * @return {$.Promise} A promise object that will be resolved when the\n     *  project is loaded and tree is rendered, or rejected if the project path\n     *  fails to load.\n     */\n    function _loadProject(rootPath) {\n\n        Metrics.valueEvent(Metrics.EVENT_TYPE.PROJECT, \"Load\",\n            isWelcomeProjectPath(rootPath) ? \"default\":\"other\", 1);\n\n        // Some legacy code calls this API with a non-canonical path\n        rootPath = ProjectModel._ensureTrailingSlash(rootPath);\n\n        if (model.projectRoot && model.projectRoot.fullPath === rootPath) {\n            return (new $.Deferred()).resolve().promise();\n        }\n\n        // About to close current project (if any)\n        if (model.projectRoot) {\n            exports.trigger(EVENT_PROJECT_BEFORE_CLOSE, model.projectRoot);\n        }\n\n        // close all the old files\n        MainViewManager._closeAll(MainViewManager.ALL_PANES);\n\n        _unwatchProjectRoot().fail(console.error);\n\n        if (model.projectRoot) {\n            LanguageManager._resetPathLanguageOverrides();\n            PreferencesManager._reloadUserPrefs(model.projectRoot);\n            exports.trigger(EVENT_PROJECT_CLOSE, model.projectRoot);\n        }\n        if(rootPath === getWelcomeProjectPath()) {\n            // welcome project path is always guaranteed to be present!\n            return _loadWelcomeProject();\n        }\n        return _loadProjectInternal(rootPath);\n    }\n\n    /**\n     * @const\n     * @private\n     * @type {number} Minimum delay in milliseconds between calls to refreshFileTree\n     */\n    var _refreshDelay = 1000;\n\n    /**\n     * Refresh the project's file tree, maintaining the current selection.\n     *\n     * Note that the original implementation of this returned a promise to be resolved when the refresh is complete.\n     * That use is deprecated and `refreshFileTree` is now a \"fire and forget\" kind of function.\n     */\n    var refreshFileTree = function refreshFileTree() {\n        FileSystem.clearAllCaches();\n        return new $.Deferred().resolve().promise();\n    };\n\n    function _showFolderFirst() {\n        const newPref = !PreferencesManager.get(SORT_DIRECTORIES_FIRST);\n        PreferencesManager.set(SORT_DIRECTORIES_FIRST, newPref);\n    }\n\n    refreshFileTree = _.debounce(refreshFileTree, _refreshDelay);\n\n    /**\n     * Expands tree nodes to show the given file or folder and selects it. Silently no-ops if the\n     * path lies outside the project, or if it doesn't exist.\n     *\n     * @param {!(File|Directory)} entry File or Directory to show\n     * @return {$.Promise} Resolved when done; or rejected if not found\n     */\n    function showInTree(entry) {\n        return model.showInTree(entry).then(_saveTreeState);\n    }\n\n    function _filePickerSupported() {\n        return Phoenix.isNativeApp\n            || window.showOpenFilePicker; // fs access file picker\n    }\n\n    /**\n     * Open a new project. Currently, Brackets must always have a project open, so\n     * this method handles both closing the current project and opening a new project.\n     *\n     * @param {string=} path Optional absolute path to the root folder of the project.\n     *  If path is undefined or null, displays a dialog where the user can choose a\n     *  folder to load. If the user cancels the dialog, nothing more happens.\n     * @return {$.Promise} A promise object that will be resolved when the\n     *  project is loaded and tree is rendered, or rejected if the project path\n     *  fails to load.\n     */\n    function openProject(path) {\n\n        var result = new $.Deferred();\n\n        if(!path && !_filePickerSupported()){\n            Dialogs.showModalDialog(\n                DefaultDialogs.DIALOG_ID_ERROR,\n                Strings.UNSUPPORTED_BROWSER_OPEN_FOLDER_TITLE,\n                Strings.UNSUPPORTED_BROWSER_OPEN_FOLDER\n            );\n            result.reject();\n            return result.promise();\n        }\n\n        // Confirm any unsaved changes first. We run the command in \"prompt-only\" mode, meaning it won't\n        // actually close any documents even on success; we'll do that manually after the user also oks\n        // the folder-browse dialog.\n        CommandManager.execute(Commands.FILE_CLOSE_ALL, { promptOnly: true })\n            .done(function () {\n                if (path) {\n                    // use specified path\n                    _loadProject(path).then(result.resolve, result.reject);\n                } else {\n                    // Pop up a folder browse dialog\n                    FileSystem.showOpenDialog(false, true, Strings.CHOOSE_FOLDER, model.projectRoot.fullPath, null, function (err, files) {\n                        if (!err && files.length > 0) {\n                            // Load the new project into the folder tree\n                            _loadProject(files[0]).then(result.resolve, result.reject);\n                        } else {\n                            result.reject();\n                        }\n                    });\n                }\n            })\n            .fail(function () {\n                result.reject();\n            });\n\n        // if fail, don't open new project: user canceled (or we failed to save its unsaved changes)\n        return result.promise();\n    }\n\n    /**\n     * Invoke project settings dialog.\n     * @return {$.Promise}\n     */\n    function _projectSettings() {\n        return PreferencesDialogs.showProjectPreferencesDialog(getBaseUrl()).getPromise();\n    }\n\n    /**\n     * Create a new item in the current project.\n     *\n     * @param baseDir {string|Directory} Full path of the directory where the item should go.\n     *   Defaults to the project root if the entry is not valid or not within the project.\n     * @param initialName {string} Initial name for the item\n     * @param skipRename {boolean} If true, don't allow the user to rename the item\n     * @param isFolder {boolean} If true, create a folder instead of a file\n     * @return {$.Promise} A promise object that will be resolved with the File\n     *  of the created object, or rejected if the user cancelled or entered an illegal\n     *  filename.\n     */\n    function createNewItem(baseDir, initialName, skipRename, isFolder) {\n        baseDir = model.getDirectoryInProject(baseDir);\n\n        if (skipRename) {\n            if(isFolder) {\n                return model.createAtPath(baseDir + initialName + \"/\");\n            }\n            return model.createAtPath(baseDir + initialName);\n        }\n        return actionCreator.startCreating(baseDir, initialName, isFolder);\n    }\n\n    function moveToTrash(entry) {\n        const result = new $.Deferred();\n        const canMoveToTrash = Phoenix.app.canMoveToTrash(entry.fullPath);\n        if(!canMoveToTrash){\n            console.error(\"Only tauri paths can be moved to trash, but got\", entry.fullPath);\n            result.reject(FileSystemError.NOT_SUPPORTED);\n            return result.promise();\n        }\n        let name = _getProjectDisplayNameOrPath(entry.fullPath);\n        const messageTemplate = Phoenix.platform === \"win\" ?\n            Strings.DELETE_TO_RECYCLE_BIN : Strings.DELETE_TO_TRASH;\n        let message = StringUtils.format(messageTemplate, name);\n        setProjectBusy(true, message);\n        Phoenix.app.moveToTrash(entry.fullPath)\n            .then(()=>{\n                DocumentManager.notifyPathDeleted(entry.fullPath);\n                let parent = window.path.dirname(entry.fullPath);\n                _updateModelWithChange(parent);\n                result.resolve();\n            }).catch(err=>{\n                _showErrorDialog(ERR_TYPE_DELETE, entry.isDirectory, FileUtils.getFileErrorString(err), entry.fullPath);\n                result.reject(err);\n            }).finally(()=>{\n                setProjectBusy(false, message);\n            });\n\n        return result.promise();\n    }\n\n    /**\n     * Delete file or directore from project\n     * @param {!(File|Directory)} entry File or Directory to delete\n     */\n    function deleteItem(entry) {\n        var result = new $.Deferred();\n        let name = _getProjectDisplayNameOrPath(entry.fullPath);\n        let message = StringUtils.format(Strings.DELETING, name);\n        setProjectBusy(true, message);\n        entry.unlink(function (err) {\n            setProjectBusy(false, message);\n            if (!err) {\n                DocumentManager.notifyPathDeleted(entry.fullPath);\n                let parent = window.path.dirname(entry.fullPath);\n                _updateModelWithChange(parent);\n                result.resolve();\n            } else {\n                _showErrorDialog(ERR_TYPE_DELETE, entry.isDirectory, FileUtils.getFileErrorString(err), entry.fullPath);\n\n                result.reject(err);\n            }\n        });\n\n        return result.promise();\n    }\n\n    /**\n     * Returns a filter for use with getAllFiles() that filters files based on LanguageManager language id\n     * @param {!(string|Array.<string>)} languageId a single string of a language id or an array of language ids\n     * @return {!function(File):boolean}\n     */\n    function getLanguageFilter(languageId) {\n        return function languageFilter(file) {\n            var id = LanguageManager.getLanguageForPath(file.fullPath).getId();\n            if (typeof languageId === \"string\") {\n                return (id === languageId);\n            }\n            return (languageId.indexOf(id) !== -1);\n\n        };\n    }\n\n    /**\n     * @private\n     *\n     * Respond to a FileSystem change event. Note that if renames are initiated\n     * externally, they may be reported as a separate removal and addition. In\n     * this case, the editor state isn't currently preserved.\n     *\n     * @param {$.Event} event\n     * @param {?(File|Directory)} entry File or Directory changed\n     * @param {Array.<FileSystemEntry>=} added If entry is a Directory, contains zero or more added children\n     * @param {Array.<FileSystemEntry>=} removed If entry is a Directory, contains zero or more removed children\n     */\n    _fileSystemChange = function (event, entry, added, removed) {\n        FileSyncManager.syncOpenDocuments();\n\n        model.handleFSEvent(entry, added, removed);\n        let removedInProject = [],\n            addedInProject = [];\n\n        // @TODO: DocumentManager should implement its own fsChange  handler\n        //          we can clean up the calls to DocumentManager.notifyPathDeleted\n        //          and privatize DocumentManager.notifyPathDeleted as well\n        //        We can also remove the _fileSystemRename handler below and move\n        //          it to DocumentManager\n        if (removed) {\n            removed.forEach(function (file) {\n                // The call to syncOpenDocuemnts above will not nofify\n                //  document manager about deleted images that are\n                //  not in the working set -- try to clean that up here\n                DocumentManager.notifyPathDeleted(file.fullPath);\n                if(isWithinProject(file)){\n                    removedInProject.push(file);\n                }\n            });\n        }\n        addedInProject = filterProjectFiles(added);\n\n        if(entry && !isWithinProject(entry)){\n            if(addedInProject && addedInProject.length && isWithinProject(addedInProject[0].parentPath)){\n                entry = FileSystem.getDirectoryForPath(addedInProject[0].parentPath);\n            } else if(removedInProject && removedInProject.length && isWithinProject(removedInProject[0].parentPath)){\n                entry = FileSystem.getDirectoryForPath(removedInProject[0].parentPath);\n            } else {\n                return;\n            }\n        }\n        exports.trigger(EVENT_PROJECT_FILE_CHANGED, entry, addedInProject, removedInProject);\n    };\n\n    function _updateModelWithChange(path) {\n        FileSystem.resolve(path, (err, entry)=>{\n            if(!err){\n                model.handleFSEvent(entry);\n            }\n        });\n    }\n\n    /**\n     * @private\n     * Respond to a FileSystem rename event.\n     */\n    _fileSystemRename = function (event, oldName, newName) {\n        // Tell the document manager about the name change. This will update\n        // all of the model information and send notification to all views\n        let oldParent = window.path.dirname(oldName),\n            newParent = window.path.dirname(newName);\n        _updateModelWithChange(oldParent);\n        if(newParent!== oldParent){\n            _updateModelWithChange(newParent);\n        }\n        DocumentManager.notifyPathNameChanged(oldName, newName);\n        exports.trigger(EVENT_PROJECT_FILE_RENAMED, oldName, newName);\n    };\n\n    /**\n     * Causes the rename operation that's in progress to complete.\n     */\n    function forceFinishRename() {\n        actionCreator.performRename();\n    }\n\n    /**\n     * @private\n     *\n     * Sets the width of the selection bar in the file tree.\n     *\n     * @param {int} width New width value\n     */\n    function _setFileTreeSelectionWidth(width) {\n        model.setSelectionWidth(width);\n        _renderTreeSync();\n    }\n\n    let _numPendingOperations = 0,\n        projectBusyMessages = [];\n\n    /**\n     * Sets or unsets project busy spinner with the specified message as reason.\n     *\n     * For Eg., if you want to mark project as busy with reason compiling project:\n     * `setProjectBusy(true, \"compiling project...\")` . The project spinner will be shown with the specified reason.\n     *\n     * Once the compilation is complete, call, we need to unset the busy status by calling:\n     * `setProjectBusy(false, \"compiling project...\")` . Make sure to pass in the exact message when\n     * calling set and unset.\n     *\n     * @param {boolean} isBusy true or false to set the project as busy or not\n     * @param {string} message The reason why the project is busy. Will be displayed as a hover tooltip on busy spinner.\n     */\n    function setProjectBusy(isBusy, message) {\n        const $projectSpinner = $(\"#project-operations-spinner\");\n        message = message || Strings.PROJECT_BUSY;\n        if(isBusy){\n            _numPendingOperations++;\n            projectBusyMessages.push(message);\n        } else{\n            _numPendingOperations--;\n            console.log(\"ProjectBusy marked by: \", projectBusyMessages);\n            console.log(\"removing busy status: \", message);\n            const index = projectBusyMessages.indexOf(message);\n            if (index > -1) {\n                // can't use array.filter here as it will filter all similar messages like [\"copy\",\"copy\"]\n                projectBusyMessages.splice(index, 1);\n            }\n            console.log(projectBusyMessages);\n        }\n        if(projectBusyMessages.length > 0){\n            $projectSpinner.attr(\"title\", projectBusyMessages.join(\", \"));\n        }\n        if(_numPendingOperations > 0){\n            $projectSpinner.removeClass(\"forced-hidden\");\n        } else {\n            $projectSpinner.addClass(\"forced-hidden\");\n        }\n    }\n\n    // after model change, queue path for selection. As there can be only one selection, the last selection wins.\n    let queuePathForSelection = null;\n    model.on(ProjectModel.EVENT_CHANGE, async ()=>{\n        // Path that is being copied can be selected only after project model is updated.\n        if(queuePathForSelection){\n            let entry = (await FileSystem.resolveAsync(queuePathForSelection)).entry;\n            if(entry.isFile){\n                actionCreator.setSelected(queuePathForSelection);\n            }\n            queuePathForSelection = null;\n        }\n    });\n\n    model.on(ProjectModel.EVENT_FS_RENAME_STARTED, ()=>{\n        setProjectBusy(true, Strings.RENAMING);\n    });\n    model.on(ProjectModel.EVENT_FS_RENAME_END, ()=>{\n        setProjectBusy(false, Strings.RENAMING);\n    });\n\n    function _duplicateFileCMD() {\n        let context = getContext();\n        let fullPath = context && context.fullPath;\n        if(!fullPath){\n            fullPath = MainViewManager.getCurrentlyViewedPath(MainViewManager.ACTIVE_PANE);\n        }\n        if(fullPath && isWithinProject(fullPath)){\n            let name = _getProjectDisplayNameOrPath(fullPath);\n            let message = StringUtils.format(Strings.DUPLICATING, name);\n            setProjectBusy(true, message);\n            FileSystem.getFreePath(fullPath, (err, dupePath)=>{\n                FileSystem.copy(fullPath, dupePath, (err, copiedStats)=>{\n                    setProjectBusy(false, message);\n                    if(err){\n                        _showErrorDialog(ERR_TYPE_DUPLICATE_FAILED, false, \"err\",\n                            _getProjectDisplayNameOrPath(fullPath));\n                        return;\n                    }\n                    FileSystem.resolve(dupePath, function (err, file) {\n                        if(!err) {\n                            // we have to wait a bit for the tree to be in sync before locating file in tree\n                            setTimeout(()=>{\n                                showInTree(file);\n                            }, 200);\n                        }\n                    });\n                });\n            });\n        } else {\n            Dialogs.showModalDialog(\n                DefaultDialogs.DIALOG_ID_ERROR,\n                Strings.CANNOT_DUPLICATE_TITLE,\n                Strings.ERR_TYPE_DUPLICATE_FAILED_NO_FILE\n            );\n        }\n    }\n\n    function _zipFailed(fullPath) {\n        _showErrorDialog(ERR_TYPE_DOWNLOAD_FAILED, false, \"err\",\n            _getProjectDisplayNameOrPath(fullPath));\n    }\n\n    function _downloadFolderCommand(downloadPath) {\n        downloadPath = downloadPath || getProjectRoot().fullPath;\n        let projectName = path.basename(downloadPath);\n        let message = StringUtils.format(Strings.DOWNLOADING_FILE, projectName);\n        setProjectBusy(true, message);\n        ZipUtils.zipFolder(downloadPath).then(zip=>{\n            return zip.generateAsync({type:\"blob\"});\n        }).then(function (blob) {\n            window.saveAs(blob, `${projectName}.zip`);\n        }).catch(()=>{\n            _zipFailed(downloadPath);\n        }).finally(()=>{\n            setProjectBusy(false, message);\n        });\n    }\n\n    function _downloadCommand(entryToDownload) {\n        let context = entryToDownload || getContext();\n        let fullPath = context && context.fullPath;\n        if(!fullPath){\n            fullPath = MainViewManager.getCurrentlyViewedPath(MainViewManager.ACTIVE_PANE);\n        }\n        if(fullPath){\n            FileSystem.resolve(fullPath, function (err, fileOrFolder) {\n                if(err) {\n                    _zipFailed(fullPath);\n                    return;\n                }\n                let name = _getProjectDisplayNameOrPath(fullPath);\n                let message = StringUtils.format(Strings.DOWNLOADING_FILE, name);\n                if(fileOrFolder.isFile){\n                    setProjectBusy(true, message);\n                    fileOrFolder.read({encoding: window.fs.BYTE_ARRAY_ENCODING}, function (err, blobContent) {\n                        if (err){\n                            _zipFailed(fullPath);\n                            return;\n                        }\n                        setProjectBusy(false, message);\n                        let blob = new Blob([blobContent], {type:\"application/octet-stream\"});\n                        window.saveAs(blob, path.basename(fullPath));\n                    });\n                } else {\n                    _downloadFolderCommand(fullPath);\n                }\n            });\n        }\n    }\n\n    const OPERATION_CUT = 'cut',\n        OPERATION_COPY = 'copy';\n\n    function _registerPathWithClipboard(path, operation) {\n        const clipboardText = window.path.basename(path);\n        Phoenix.app.copyToClipboard(clipboardText);\n        PhStore.setItem(CLIPBOARD_SYNC_KEY, {\n            operation: operation,\n            path: path,\n            clipboardText: clipboardText\n        });\n    }\n\n    /**\n     * Return the project root relative path of the given path.\n     * @param {string} path\n     * @return {string}\n     */\n    function getProjectRelativePath(path) {\n        let projectRootParent = window.path.dirname(getProjectRoot().fullPath);\n        let relativePath = window.path.relative(projectRootParent, path);\n        return relativePath;\n    }\n\n    function _getProjectDisplayNameOrPath(path) {\n        // sometimes, when we copy across projects, there can be two project roots at work. For eg, when copying\n        // across /mnt/prj1 and /app/local/prj2; both should correctly resolve to prj1/ and prj2/ even though only\n        // /mnt/prj1 is the current active project root. So we cannot really use getProjectRoot().fullPath for all cases\n        let projectRootParent = window.path.dirname(getProjectRoot().fullPath);\n        let displayPath = window.path.relative(projectRootParent, path);\n        if(path.startsWith(Phoenix.VFS.getMountDir())){\n            displayPath = window.path.relative(Phoenix.VFS.getMountDir(), path);\n        } else if(path.startsWith(Phoenix.VFS.getTauriDir())){\n            displayPath = window.fs.getTauriPlatformPath(path);\n        } else if(path.startsWith(Phoenix.VFS._getVirtualDocumentsDirectory())){\n            displayPath = window.path.relative(Phoenix.VFS._getVirtualDocumentsDirectory(), path);\n        }\n        return displayPath;\n    }\n\n    function _copyProjectRelativePath() {\n        let context = getContext();\n        let fullPath = context && context.fullPath;\n        if(!fullPath){\n            fullPath = MainViewManager.getCurrentlyViewedPath(MainViewManager.ACTIVE_PANE);\n        }\n        if(fullPath){\n            let pathToCopy = makeProjectRelativeIfPossible(fullPath);\n            Phoenix.app.copyToClipboard(pathToCopy);\n            PhStore.setItem(CLIPBOARD_SYNC_KEY, {});\n        }\n    }\n\n    function _cutFileCMD() {\n        let context = getContext();\n        let fullPath = context && context.fullPath;\n        if(!fullPath){\n            fullPath = MainViewManager.getCurrentlyViewedPath(MainViewManager.ACTIVE_PANE);\n        }\n        if(fullPath){\n            _registerPathWithClipboard(fullPath, OPERATION_CUT);\n        }\n    }\n\n    function _copyFileCMD() {\n        let context = getContext();\n        let fullPath = context && context.fullPath;\n        if(!fullPath){\n            fullPath = MainViewManager.getCurrentlyViewedPath(MainViewManager.ACTIVE_PANE);\n        }\n        if(fullPath){\n            _registerPathWithClipboard(fullPath, OPERATION_COPY);\n        }\n    }\n\n    // this function should be given a destination that always exists, be it file or dir\n    function _getPasteTarget(dstThatExists) {\n        return new Promise(async (resolve, reject)=>{ // eslint-disable-line\n            try {\n                let entry = (await FileSystem.resolveAsync(dstThatExists)).entry;\n                if(entry.isFile){\n                    let parent = window.path.dirname(dstThatExists);\n                    let parentEntry = (await FileSystem.resolveAsync(parent)).entry;\n                    resolve(parentEntry);\n                } else {\n                    resolve(entry);\n                }\n            } catch (e) {\n                reject(e);\n            }\n        });\n    }\n\n    function _isSameOrSubPathOf(dir, subDir) {\n        if(dir === subDir){\n            return true;\n        }\n        const relative = window.path.relative(dir, subDir);\n        return relative && !relative.startsWith('..') && !window.path.isAbsolute(relative);\n    }\n\n    async function _validatePasteTarget(srcEntry, targetEntry) {\n        if(_isSameOrSubPathOf(srcEntry.fullPath, targetEntry.fullPath)){\n            _showErrorDialog(ERR_TYPE_PASTE_FAILED, srcEntry.isDirectory, \"err\",\n                _getProjectDisplayNameOrPath(srcEntry.fullPath),\n                _getProjectDisplayNameOrPath(targetEntry.fullPath));\n            return false;\n        }\n        let baseName = window.path.basename(srcEntry.fullPath);\n        let targetPath = window.path.normalize(`${targetEntry.fullPath}/${baseName}`);\n        let exists = await FileSystem.existsAsync(targetPath);\n        if(exists){\n            _showErrorDialog(ERR_TYPE_PASTE, srcEntry.isDirectory, \"err\", _getProjectDisplayNameOrPath(targetPath));\n            return false;\n        }\n        return true;\n    }\n\n    async function _performCut(src, dst) {\n        let target = await _getPasteTarget(dst);\n        let srcEntry = (await FileSystem.resolveAsync(src)).entry;\n        let canPaste = await _validatePasteTarget(srcEntry, target);\n        if(canPaste){\n            let baseName = window.path.basename(srcEntry.fullPath);\n            let targetPath = window.path.normalize(`${target.fullPath}/${baseName}`);\n            let message = StringUtils.format(Strings.MOVING, _getProjectDisplayNameOrPath(srcEntry.fullPath));\n            setProjectBusy(true, message);\n            srcEntry.rename(targetPath, (err)=>{\n                setProjectBusy(false, message);\n                if(err){\n                    _showErrorDialog(ERR_TYPE_PASTE_FAILED, srcEntry.isDirectory, \"err\",\n                        _getProjectDisplayNameOrPath(srcEntry.fullPath),\n                        _getProjectDisplayNameOrPath(target.fullPath));\n                    return;\n                }\n                queuePathForSelection = targetPath;\n            });\n        }\n    }\n\n    async function _performCopy(src, dst) {\n        let target = await _getPasteTarget(dst);\n        let srcEntry = (await FileSystem.resolveAsync(src)).entry;\n        let canPaste = await _validatePasteTarget(srcEntry, target);\n        if(canPaste){\n            let name = _getProjectDisplayNameOrPath(srcEntry.fullPath);\n            let message = StringUtils.format(Strings.COPYING, name);\n            setProjectBusy(true, message);\n            FileSystem.copy(srcEntry.fullPath, target.fullPath, (err, targetStat)=>{\n                setProjectBusy(false, message);\n                if(err){\n                    _showErrorDialog(ERR_TYPE_PASTE_FAILED, srcEntry.isDirectory, \"err\",\n                        _getProjectDisplayNameOrPath(srcEntry.fullPath),\n                        _getProjectDisplayNameOrPath(target.fullPath));\n                    return;\n                }\n                queuePathForSelection = targetStat.realPath;\n            });\n        }\n    }\n\n    async function _pasteFileCMD() {\n        let targetPath = getProjectRoot().fullPath;\n        let context = getContext();\n        if(context){\n            targetPath = context.fullPath;\n        }\n\n        const copiedFiles = await Phoenix.app.clipboardReadFiles();\n        if(copiedFiles) {\n            // there were some files the user copied external, eg. from os file explorer. This takes precedence\n            for(let copiedFileOrFolderPath of copiedFiles){\n                _performCopy(copiedFileOrFolderPath, targetPath);\n            }\n            return;\n        }\n\n        const clipboardText = await Phoenix.app.clipboardReadText();\n        const clipboard = PhStore.getItem(CLIPBOARD_SYNC_KEY);\n        if(!clipboard || clipboard.clipboardText !== clipboardText){\n            // either no copied file, or user copied something outside the app.\n            return;\n        }\n        switch (clipboard.operation) {\n        case OPERATION_CUT: await _performCut(clipboard.path, targetPath); break;\n        case OPERATION_COPY: await _performCopy(clipboard.path, targetPath); break;\n        default: console.error(\"Clipboard unknown Operation: \", clipboard, targetPath);\n        }\n    }\n\n    // Initialize variables and listeners that depend on the HTML DOM\n    AppInit.htmlReady(function () {\n        PhStore.watchExternalChanges(CLIPBOARD_SYNC_KEY);\n        $projectTreeContainer = $(\"#project-files-container\");\n        $projectTreeContainer.addClass(\"jstree jstree-brackets\");\n        $projectTreeContainer.css(\"overflow\", \"auto\");\n        $projectTreeContainer.css(\"position\", \"relative\");\n\n        fileTreeViewContainer = $(\"<div>\").appendTo($projectTreeContainer)[0];\n\n        model.setSelectionWidth($projectTreeContainer.width());\n\n        $(\".main-view\").click(function (jqEvent) {\n            if (!jqEvent.target.classList.contains(\"jstree-rename-input\")) {\n                forceFinishRename();\n                actionCreator.setContext(null);\n            }\n        });\n\n        $(\"#working-set-list-container\").on(EVENT_CONTENT_CHANGED, function () {\n            $projectTreeContainer.trigger(EVENT_CONTENT_CHANGED);\n        });\n\n        Menus.getContextMenu(Menus.ContextMenuIds.PROJECT_MENU).on(\"beforeContextMenuOpen\", function () {\n            actionCreator.restoreContext();\n        });\n\n        Menus.getContextMenu(Menus.ContextMenuIds.PROJECT_MENU).on(\"beforeContextMenuClose\", function () {\n            model.setContext(null, false, true);\n        });\n\n        $projectTreeContainer.on(\"contextmenu\", function () {\n            forceFinishRename();\n        });\n\n        $projectTreeContainer.on(\"dragover\", function(e) {\n            e.preventDefault();\n        });\n\n        // Add support for moving items to root directory\n        $projectTreeContainer.on(\"drop\", function(e) {\n            var data = JSON.parse(e.originalEvent.dataTransfer.getData(\"text\"));\n            actionCreator.moveItem(data.path, getProjectRoot().fullPath);\n            e.stopPropagation();\n        });\n\n        // When a context menu item is selected, we need to clear the context\n        // because we don't get a beforeContextMenuClose event since Bootstrap\n        // handles this directly.\n        $(\"#project-context-menu\").on(\"click.dropdown-menu\", function () {\n            model.setContext(null, true);\n        });\n\n        $projectTreeContainer.on(\"scroll\", function () {\n            // Close open menus on scroll and clear the context, but only if there's a menu open.\n            if ($(\".dropdown.open\").length > 0) {\n                Menus.closeAll();\n                actionCreator.setContext(null);\n            }\n            // we need to render the tree without a delay to not cause selection extension issues (#10573)\n            _renderTreeSync();\n        });\n\n        _renderTree();\n\n        ViewUtils.addScrollerShadow($projectTreeContainer[0]);\n    });\n\n    EventDispatcher.makeEventDispatcher(exports);\n\n    // Init default project path to welcome project\n    PreferencesManager.stateManager.definePreference(\"projectPath\", \"string\", getWelcomeProjectPath());\n\n    function _setProjectDownloadCommandEnabled(_event, projectRoot) {\n        CommandManager.get(Commands.FILE_DOWNLOAD_PROJECT)\n            .setEnabled(!Phoenix.VFS.isLocalDiscPath(projectRoot.fullPath));\n        CommandManager.get(Commands.FILE_DOWNLOAD)\n            .setEnabled(!Phoenix.VFS.isLocalDiscPath(projectRoot.fullPath));\n    }\n\n    const UNSAFE_PROJECT_EXIT_PREFIX = \"_Unafe_project_exit_\";\n    function _flagProjectNotExitedSafely(projectRootPath) {\n        // we store this in local storage as these checks happen in app exit/startup flows where\n        // phstore is not reliable. It's ok to lose this data.\n        PhStore.setItem(UNSAFE_PROJECT_EXIT_PREFIX+projectRootPath, true);\n        PhStore.persistDBForReboot(); // promise is ignored here.\n    }\n    function _flagProjectExitedSafely(projectRootPath) {\n        PhStore.removeItem(UNSAFE_PROJECT_EXIT_PREFIX+projectRootPath);\n    }\n    function _isProjectSafeToStartup(projectRootPath) {\n        // In some cases, For eg: user tries to open a whole drive with phcode (or any project that makes phcode crash),\n        // phoenix may get stuck and never open again with the bad project as we try to open the same bad project\n        // on restart. So we keep a safe exit flag with each project. We only start the project on boot if it has\n        // been marked safe at previous exit or project switch. So on unsafe exit, the default project will be opened.\n        const unsafeExit = (PhStore.getItem(UNSAFE_PROJECT_EXIT_PREFIX+projectRootPath) === true);\n        if(unsafeExit){\n            console.error(`Project ${projectRootPath} marked as not safe to startup during`+\n                `previous exit. Starting default project`);\n        }\n        return !unsafeExit;\n    }\n\n    function _entryToPathSet(entryArray) {\n        if (!entryArray || !entryArray.length) {\n            return new Set();\n        }\n        return new Set(entryArray.map(entry => path.normalize(entry.fullPath)));\n    }\n\n    exports.on(EVENT_PROJECT_FILE_CHANGED, (_evt, entry, addedInProject, removedInProject)=>{\n        if(!entry && !addedInProject && !removedInProject){\n            // when clearing the cached files forcefully, empty change events may get trigerred, in which case ignore.\n            return;\n        }\n        const addedSet = _entryToPathSet(addedInProject);\n        const removedSet = _entryToPathSet(removedInProject);\n        if(!entry && !addedSet.size && !removedSet.size){\n            return;\n        }\n        exports.trigger(EVENT_PROJECT_CHANGED_OR_RENAMED_PATH, entry && path.normalize(entry.fullPath),\n            addedSet, removedSet);\n    });\n    exports.on(EVENT_PROJECT_FILE_RENAMED, (_evt, oldPath, newPath)=>{\n        oldPath = path.normalize(oldPath);\n        newPath = path.normalize(newPath);\n        if(oldPath === newPath){\n            return; // no change\n        }\n        const oldParent = path.dirname(oldPath), newParent = path.dirname(newPath);\n        if(oldParent === newParent) {\n            exports.trigger(EVENT_PROJECT_CHANGED_OR_RENAMED_PATH, newParent, new Set([newPath]), new Set([oldPath]));\n        } else {\n            exports.trigger(EVENT_PROJECT_CHANGED_OR_RENAMED_PATH, oldParent, new Set(), new Set([oldPath]));\n            exports.trigger(EVENT_PROJECT_CHANGED_OR_RENAMED_PATH, newParent, new Set([newPath]), new Set());\n        }\n    });\n\n    exports.on(EVENT_PROJECT_OPEN, (_evt, projectRoot)=>{\n        _reloadProjectPreferencesScope();\n        _saveProjectPath();\n        _setProjectDownloadCommandEnabled(_evt, projectRoot);\n        _flagProjectNotExitedSafely(projectRoot.fullPath);\n    });\n\n    exports.on(EVENT_PROJECT_CLOSE, (_evt, projectRoot)=>{\n        _flagProjectExitedSafely(projectRoot.fullPath);\n    });\n    exports.on(\"beforeAppClose\", ()=> {\n        _saveProjectPath();\n        _flagProjectExitedSafely(getProjectRoot().fullPath);\n        _unwatchProjectRoot();\n    });\n    let startupFilesLoaded = false;\n    exports.on(EVENT_AFTER_STARTUP_FILES_LOADED, ()=>{\n        startupFilesLoaded = true;\n    });\n\n    function isStartupFilesLoaded() {\n        return startupFilesLoaded;\n    }\n\n    // Due to circular dependencies, not safe to call on() directly for other modules' events\n    EventDispatcher.on_duringInit(FileViewController, \"documentSelectionFocusChange\", _documentSelectionFocusChange);\n    EventDispatcher.on_duringInit(FileViewController, \"fileViewFocusChange\", _fileViewControllerChange);\n    EventDispatcher.on_duringInit(MainViewManager, \"currentFileChange\", _currentFileChange);\n\n    // Commands\n    CommandManager.register(Strings.CMD_OPEN_FOLDER,      Commands.FILE_OPEN_FOLDER,      openProject);\n    CommandManager.register(Strings.CMD_PROJECT_SETTINGS, Commands.FILE_PROJECT_SETTINGS, _projectSettings);\n    CommandManager.register(Strings.CMD_FILE_REFRESH,     Commands.FILE_REFRESH,          refreshFileTree);\n    CommandManager.register(Strings.CMD_FILE_CUT, Commands.FILE_CUT, _cutFileCMD);\n    CommandManager.register(Strings.CMD_FILE_COPY, Commands.FILE_COPY, _copyFileCMD);\n    CommandManager.register(Strings.CMD_FILE_COPY_PATH, Commands.FILE_COPY_PATH, _copyProjectRelativePath);\n    CommandManager.register(Strings.CMD_FILE_PASTE, Commands.FILE_PASTE, _pasteFileCMD);\n    CommandManager.register(Strings.CMD_FILE_DUPLICATE, Commands.FILE_DUPLICATE, _duplicateFileCMD);\n    CommandManager.register(Strings.CMD_FILE_DUPLICATE_FILE, Commands.FILE_DUPLICATE_FILE, _duplicateFileCMD);\n    CommandManager.register(Strings.CMD_FILE_DOWNLOAD_PROJECT, Commands.FILE_DOWNLOAD_PROJECT, _downloadFolderCommand);\n    CommandManager.register(Strings.CMD_FILE_DOWNLOAD, Commands.FILE_DOWNLOAD, _downloadCommand);\n\n    // Define the preference to decide how to sort the Project Tree files\n    PreferencesManager.definePreference(SORT_DIRECTORIES_FIRST, \"boolean\", true, {\n        description: Strings.DESCRIPTION_SORT_DIRECTORIES_FIRST\n    })\n        .on(\"change\", function () {\n            let sortPref = PreferencesManager.get(SORT_DIRECTORIES_FIRST);\n            actionCreator.setSortDirectoriesFirst(sortPref);\n            CommandManager.get(Commands.FILE_SHOW_FOLDERS_FIRST).setChecked(sortPref);\n        });\n    CommandManager.register(Strings.CMD_FILE_SHOW_FOLDERS_FIRST, Commands.FILE_SHOW_FOLDERS_FIRST, _showFolderFirst);\n    CommandManager.get(Commands.FILE_SHOW_FOLDERS_FIRST).setChecked(PreferencesManager.get(SORT_DIRECTORIES_FIRST));\n\n    actionCreator.setSortDirectoriesFirst(PreferencesManager.get(SORT_DIRECTORIES_FIRST));\n\n    /**\n     * Gets the filesystem object for the current context in the file tree.\n     */\n    function getContext() {\n        return model.getContext();\n    }\n\n    /**\n     * Starts a rename operation, completing the current operation if there is one.\n     *\n     * The Promise returned is resolved with an object with a `newPath` property with the renamed path. If the user cancels the operation, the promise is resolved with the value RENAME_CANCELLED.\n     *\n     * @param {FileSystemEntry} entry file or directory filesystem object to rename\n     * @param {boolean=} isMoved optional flag which indicates whether the entry is being moved instead of renamed\n     * @return {$.Promise} a promise resolved when the rename is done.\n     */\n    function renameItemInline(entry, isMoved) {\n        var d = new $.Deferred();\n\n        model.startRename(entry, isMoved)\n            .done(function () {\n                d.resolve();\n            })\n            .fail(function (errorInfo) {\n                // Need to do display the error message on the next event loop turn\n                // because some errors can come up synchronously and then the dialog\n                // is not displayed.\n                window.setTimeout(function () {\n                    if (isMoved) {\n                        switch (errorInfo.type) {\n                        case FileSystemError.ALREADY_EXISTS:\n                            _showErrorDialog(ERR_TYPE_MOVE, errorInfo.isFolder, Strings.FILE_EXISTS_ERR, errorInfo.fullPath);\n                            break;\n                        case ProjectModel.ERROR_NOT_IN_PROJECT:\n                            _showErrorDialog(ERR_TYPE_MOVE, errorInfo.isFolder, Strings.ERROR_MOVING_NOT_IN_PROJECT, errorInfo.fullPath);\n                            break;\n                        default:\n                            _showErrorDialog(ERR_TYPE_MOVE, errorInfo.isFolder, FileUtils.getFileErrorString(errorInfo.type), errorInfo.fullPath);\n                        }\n                    } else {\n                        switch (errorInfo.type) {\n                        case ProjectModel.ERROR_INVALID_FILENAME:\n                            _showErrorDialog(ERR_TYPE_INVALID_FILENAME, errorInfo.isFolder, ProjectModel._invalidChars);\n                            break;\n                        case FileSystemError.ALREADY_EXISTS:\n                            _showErrorDialog(ERR_TYPE_RENAME, errorInfo.isFolder, Strings.FILE_EXISTS_ERR, errorInfo.fullPath);\n                            break;\n                        case ProjectModel.ERROR_NOT_IN_PROJECT:\n                            _showErrorDialog(ERR_TYPE_RENAME, errorInfo.isFolder, Strings.ERROR_RENAMING_NOT_IN_PROJECT, errorInfo.fullPath);\n                            break;\n                        default:\n                            _showErrorDialog(ERR_TYPE_RENAME, errorInfo.isFolder, FileUtils.getFileErrorString(errorInfo.type), errorInfo.fullPath);\n                        }\n                    }\n                }, 10);\n                d.reject(errorInfo);\n            });\n        return d.promise();\n    }\n\n    /**\n     * Returns an Array of all files for this project, optionally including\n     * files in the working set that are *not* under the project root. Files are\n     * filtered first by ProjectModel.shouldShow(), then by the custom filter\n     * argument (if one was provided).\n     *\n     * @param {function (File, number):boolean=} filter Optional function to filter\n     *          the file list (does not filter directory traversal). API matches Array.filter().\n     * @param {boolean=} includeWorkingSet If true, include files in the working set\n     *          that are not under the project root (*except* for untitled documents).\n     * @param {boolean=} sort If true, The files will be sorted by their paths\n     * @param {Object} options optional path within project to narrow down the search\n     * @param {File} options.scope optional path within project to narrow down the search\n     *\n     * @return {$.Promise} Promise that is resolved with an Array of File objects.\n     */\n    function getAllFiles(filter, includeWorkingSet, sort, options) {\n        var viewFiles, deferred;\n\n        // The filter and includeWorkingSet params are both optional.\n        // Handle the case where filter is omitted but includeWorkingSet is\n        // specified.\n        if (typeof (filter) !== \"function\") {\n            options = sort;\n            sort = includeWorkingSet;\n            includeWorkingSet = filter;\n            filter = null;\n        }\n        options = options || {};\n\n        if (includeWorkingSet) {\n            viewFiles = MainViewManager.getWorkingSet(MainViewManager.ALL_PANES);\n        }\n\n        deferred = new $.Deferred();\n        model.getAllFiles(filter, viewFiles, sort, {scope: options.scope})\n            .done(function (fileList) {\n                deferred.resolve(fileList);\n            })\n            .fail(function (err) {\n                if (err === FileSystemError.TOO_MANY_ENTRIES && !_projectWarnedForTooManyFiles) {\n                    _showErrorDialog(ERR_TYPE_MAX_FILES);\n                    _projectWarnedForTooManyFiles = true;\n                }\n                // resolve with empty list\n                deferred.resolve([]);\n            });\n        return deferred.promise();\n    }\n\n    /**\n     * Adds an icon provider. The callback is invoked before each working set item is created, and can\n     * return content to prepend to the item if it supports the icon.\n     *\n     * @param {!function(!{name:string, fullPath:string, isFile:boolean}):?string|jQuery|DOMNode} callback\n     * Return a string representing the HTML, a jQuery object or DOM node, or undefined. If undefined,\n     * nothing is prepended to the list item and the default or an available icon will be used.\n     * @param {number} [priority] optional priority. 0 being lowest. The icons with the highest priority wins if there\n     * are multiple callback providers attached. icon providers of the same priority first valid response wins.\n     */\n    function addIconProvider(callback, priority= 0) {\n        WorkingSetView.addIconProvider(callback, priority);\n        FileTreeView.addIconProvider(callback, priority);\n        rerenderTree();\n    }\n\n    /**\n     * Adds a CSS class provider, invoked before each working set item is created or updated. When called\n     * to update an existing item, all previously applied classes have been cleared.\n     *\n     * @param {!function(!{name:string, fullPath:string, isFile:boolean}):?string} callback\n     * Return a string containing space-separated CSS class(es) to add, or undefined to leave CSS unchanged.\n     * @param {number} [priority] optional priority. 0 being lowest. The class with the highest priority wins if there\n     * are multiple callback classes attached. class providers of the same priority will be appended.\n     */\n    function addClassesProvider(callback, priority) {\n        WorkingSetView.addClassProvider(callback, priority);\n        FileTreeView.addClassesProvider(callback, priority);\n        rerenderTree();\n    }\n\n    /**\n     * Forces the file tree to rerender. Typically, the tree only rerenders the portions of the\n     * tree that have changed data. If an extension that augments the tree has changes that it\n     * needs to display, calling rerenderTree will cause the components for the whole tree to\n     * be rerendered.\n     */\n    function rerenderTree() {\n        _renderTree(true);\n    }\n\n\n    // Private API helpful in testing\n    exports._actionCreator                = actionCreator;\n    exports._RENDER_DEBOUNCE_TIME         = _RENDER_DEBOUNCE_TIME;\n\n    // Private API for use with SidebarView\n    exports._setFileTreeSelectionWidth    = _setFileTreeSelectionWidth;\n\n    // Define public API\n    exports.getProjectRoot                = getProjectRoot;\n    exports.getBaseUrl                    = getBaseUrl;\n    exports.setBaseUrl                    = setBaseUrl;\n    exports.isWithinProject               = isWithinProject;\n    exports.filterProjectFiles            = filterProjectFiles;\n    exports.makeProjectRelativeIfPossible = makeProjectRelativeIfPossible;\n    exports.shouldShow                    = ProjectModel.shouldShow;\n    exports.shouldIndex                   = ProjectModel.shouldIndex;\n    exports.openProject                   = openProject;\n    exports.getFileTreeContext            = getFileTreeContext;\n    exports.getSelectedItem               = getSelectedItem;\n    exports.getContext                    = getContext;\n    exports.getInitialProjectPath         = getInitialProjectPath;\n    exports.getStartupProjectPath         = getStartupProjectPath;\n    exports.getProjectRelativePath        = getProjectRelativePath;\n    exports.getProjectRelativeOrDisplayPath = getProjectRelativeOrDisplayPath;\n    exports.getWelcomeProjectPath         = getWelcomeProjectPath;\n    exports.getPlaceholderProjectPath     = getPlaceholderProjectPath;\n    exports.getExploreProjectPath         = getExploreProjectPath;\n    exports.getLocalProjectsPath          = getLocalProjectsPath;\n    exports.isWelcomeProjectPath          = isWelcomeProjectPath;\n    exports.updateWelcomeProjectPath      = updateWelcomeProjectPath;\n    exports.createNewItem                 = createNewItem;\n    exports.renameItemInline              = renameItemInline;\n    exports.deleteItem                    = deleteItem;\n    exports.moveToTrash                   = moveToTrash;\n    exports.forceFinishRename             = forceFinishRename;\n    exports.showInTree                    = showInTree;\n    exports.shouldShowFileNameInTree      = ProjectModel._shouldShowName;\n    exports.refreshFileTree               = refreshFileTree;\n    exports.getAllFiles                   = getAllFiles;\n    exports.getLanguageFilter             = getLanguageFilter;\n    exports.addIconProvider               = addIconProvider;\n    exports.addClassesProvider            = addClassesProvider;\n    exports.rerenderTree                  = rerenderTree;\n    exports.setProjectBusy                = setProjectBusy;\n    exports.isStartupFilesLoaded          = isStartupFilesLoaded;\n\n    // public events\n    exports.EVENT_PROJECT_BEFORE_CLOSE = EVENT_PROJECT_BEFORE_CLOSE;\n    exports.EVENT_PROJECT_CLOSE = EVENT_PROJECT_CLOSE;\n    exports.EVENT_PROJECT_OPEN = EVENT_PROJECT_OPEN;\n    exports.EVENT_AFTER_PROJECT_OPEN = EVENT_AFTER_PROJECT_OPEN;\n    exports.EVENT_AFTER_STARTUP_FILES_LOADED = EVENT_AFTER_STARTUP_FILES_LOADED;\n    exports.EVENT_PROJECT_REFRESH = EVENT_PROJECT_REFRESH;\n    exports.EVENT_CONTENT_CHANGED = EVENT_CONTENT_CHANGED;\n    exports.EVENT_PROJECT_FILE_CHANGED = EVENT_PROJECT_FILE_CHANGED;\n    exports.EVENT_PROJECT_FILE_RENAMED = EVENT_PROJECT_FILE_RENAMED;\n    exports.EVENT_PROJECT_CHANGED_OR_RENAMED_PATH = EVENT_PROJECT_CHANGED_OR_RENAMED_PATH;\n    exports.EVENT_PROJECT_OPEN_FAILED = EVENT_PROJECT_OPEN_FAILED;\n});\n"],"file":"ProjectManager.js"}